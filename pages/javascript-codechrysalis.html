<!DOCTYPE html><html><head><meta charset="utf-8"><style>@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff');
}

* {
    box-sizing: border-box;
}

body {
    width: 980px;
    margin-right: auto;
    margin-left: auto;
}

body .markdown-body {
    padding: 45px;
    border: 1px solid #ddd;
    border-radius: 3px;
    word-wrap: break-word;
}

pre {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body input {
  font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4078c0;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .select::-ms-expand {
  opacity: 0;
}

.markdown-body .octicon {
  font: normal normal normal 16px/1 octicons-anchor;
  display: inline-block;
  text-decoration: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body:before {
  display: table;
  content: "";
}

.markdown-body:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body .anchor {
  display: inline-block;
  padding-right: 2px;
  margin-left: -18px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #000;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h1 .anchor {
  line-height: 1;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 .anchor {
  line-height: 1;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h3 .anchor {
  line-height: 1.2;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h4 .anchor {
  line-height: 1.2;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h5 .anchor {
  line-height: 1.1;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body h6 .anchor {
  line-height: 1.1;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: content-box;
  background-color: #fff;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #183691;
}

.markdown-body .pl-v {
  color: #ed6a43;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .plan-price-unit {
  color: #767676;
  font-weight: normal;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 0.35em 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body .plan-choice {
  padding: 15px;
  padding-left: 40px;
  display: block;
  border: 1px solid #e0e0e0;
  position: relative;
  font-weight: normal;
  background-color: #fafafa;
}

.markdown-body .plan-choice.open {
  background-color: #fff;
}

.markdown-body .plan-choice.open .plan-choice-seat-breakdown {
  display: block;
}

.markdown-body .plan-choice-free {
  border-radius: 3px 3px 0 0;
}

.markdown-body .plan-choice-paid {
  border-radius: 0 0 3px 3px;
  border-top: 0;
  margin-bottom: 20px;
}

.markdown-body .plan-choice-radio {
  position: absolute;
  left: 15px;
  top: 18px;
}

.markdown-body .plan-choice-exp {
  color: #999;
  font-size: 12px;
  margin-top: 5px;
}

.markdown-body .plan-choice-seat-breakdown {
  margin-top: 10px;
  display: none;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4078c0;
}
</style><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  extensions: ["tex2jax.js"],
  jax: ["input/TeX"],
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: false
  },
  TeX: {
    extensions: ["AMSmath.js", "AMSsymbols.js"],
    TagSide: "right",
    TagIndent: ".8em",
    MultLineWidth: "85%",
    equationNumbers: {
      autoNumber: "AMS",
    },
    unicode: {
      fonts: "STIXGeneral,'Arial Unicode MS'"
    }
  },
  showProcessingMessages: false
});
</script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.4/sequence-diagram-min.js"></script>
<script type="text/javascript">// flowchart, v1.3.4
// Copyright (c)2014 Adriano Raiano (adrai).
// Distributed under MIT license
// http://adrai.github.io/flowchart.js
!function(){function a(b,c){if(!b||"function"==typeof b)return c;var d={};for(var e in c)d[e]=c[e];for(e in b)b[e]&&(d[e]="object"==typeof d[e]?a(d[e],b[e]):b[e]);return d}function b(a,b){if("function"==typeof Object.create)a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});else{a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}}function c(a,b,c){var d,e,f="M{0},{1}";for(d=2,e=2*c.length+2;e>d;d+=2)f+=" L{"+d+"},{"+(d+1)+"}";var g=[b.x,b.y];for(d=0,e=c.length;e>d;d++)g.push(c[d].x),g.push(c[d].y);var h=a.paper.path(f,g);h.attr("stroke",a.options["element-color"]),h.attr("stroke-width",a.options["line-width"]);var i=a.options.font,j=a.options["font-family"],k=a.options["font-weight"];return i&&h.attr({font:i}),j&&h.attr({"font-family":j}),k&&h.attr({"font-weight":k}),h}function d(a,b,c,d){var e,f;"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var g="M{0},{1}";for(e=2,f=2*c.length+2;f>e;e+=2)g+=" L{"+e+"},{"+(e+1)+"}";var h=[b.x,b.y];for(e=0,f=c.length;f>e;e++)h.push(c[e].x),h.push(c[e].y);var i=a.paper.path(g,h);i.attr({stroke:a.options["line-color"],"stroke-width":a.options["line-width"],"arrow-end":a.options["arrow-end"]});var j=a.options.font,k=a.options["font-family"],l=a.options["font-weight"];if(j&&i.attr({font:j}),k&&i.attr({"font-family":k}),l&&i.attr({"font-weight":l}),d){var m=!1,n=a.paper.text(0,0,d),o=!1,p=c[0];b.y===p.y&&(o=!0);var q=0,r=0;m?(q=b.x>p.x?b.x-(b.x-p.x)/2:p.x-(p.x-b.x)/2,r=b.y>p.y?b.y-(b.y-p.y)/2:p.y-(p.y-b.y)/2,o?(q-=n.getBBox().width/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"],r-=n.getBBox().height/2)):(q=b.x,r=b.y,o?(q+=a.options["text-margin"]/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"]/2,r+=a.options["text-margin"])),n.attr({"text-anchor":"start","font-size":a.options["font-size"],fill:a.options["font-color"],x:q,y:r}),j&&n.attr({font:j}),k&&n.attr({"font-family":k}),l&&n.attr({"font-weight":l})}return i}function e(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};return i=(h-f)*(c-a)-(g-e)*(d-b),0===i?n:(j=b-f,k=a-e,l=(g-e)*j-(h-f)*k,m=(c-a)*j-(d-b)*k,j=l/i,k=m/i,n.x=a+j*(c-a),n.y=b+j*(d-b),j>0&&1>j&&(n.onLine1=!0),k>0&&1>k&&(n.onLine2=!0),n)}function f(a,b){b=b||{},this.paper=new Raphael(a),this.options=r.defaults(b,q),this.symbols=[],this.lines=[],this.start=null}function g(a,b,c){this.chart=a,this.group=this.chart.paper.set(),this.symbol=c,this.connectedTo=[],this.symbolType=b.symbolType,this.flowstate=b.flowstate||"future",this.next_direction=b.next&&b.direction_next?b.direction_next:void 0,this.text=this.chart.paper.text(0,0,b.text),b.key&&(this.text.node.id=b.key+"t"),this.text.node.setAttribute("class",this.getAttr("class")+"t"),this.text.attr({"text-anchor":"start",x:this.getAttr("text-margin"),fill:this.getAttr("font-color"),"font-size":this.getAttr("font-size")});var d=this.getAttr("font"),e=this.getAttr("font-family"),f=this.getAttr("font-weight");d&&this.text.attr({font:d}),e&&this.text.attr({"font-family":e}),f&&this.text.attr({"font-weight":f}),b.link&&this.text.attr("href",b.link),b.target&&this.text.attr("target",b.target);var g=this.getAttr("maxWidth");if(g){for(var h=b.text.split(" "),i="",j=0,k=h.length;k>j;j++){var l=h[j];this.text.attr("text",i+" "+l),i+=this.text.getBBox().width>g?"\n"+l:" "+l}this.text.attr("text",i.substring(1))}if(this.group.push(this.text),c){var m=this.getAttr("text-margin");c.attr({fill:this.getAttr("fill"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*m,height:this.text.getBBox().height+2*m}),c.node.setAttribute("class",this.getAttr("class")),b.link&&c.attr("href",b.link),b.target&&c.attr("target",b.target),b.key&&(c.node.id=b.key),this.group.push(c),c.insertBefore(this.text),this.text.attr({y:c.getBBox().height/2}),this.initialize()}}function h(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"Start",g.call(this,a,b,c)}function i(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"End",g.call(this,a,b,c)}function j(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c)}function k(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c),c.attr({width:this.text.getBBox().width+4*this.getAttr("text-margin")}),this.text.attr({x:2*this.getAttr("text-margin")});var d=a.paper.rect(0,0,0,0);d.attr({x:this.getAttr("text-margin"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*this.getAttr("text-margin"),height:this.text.getBBox().height+2*this.getAttr("text-margin"),fill:this.getAttr("fill")}),b.key&&(d.node.id=b.key+"i");var e=this.getAttr("font"),f=this.getAttr("font-family"),h=this.getAttr("font-weight");e&&d.attr({font:e}),f&&d.attr({"font-family":f}),h&&d.attr({"font-weight":h}),b.link&&d.attr("href",b.link),b.target&&d.attr("target",b.target),this.group.push(d),d.insertBefore(this.text),this.initialize()}function l(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.text.attr({x:3*this.textMargin});var d=this.text.getBBox().width+4*this.textMargin,e=this.text.getBBox().height+2*this.textMargin,f=this.textMargin,h=e/2,i={x:f,y:h},j=[{x:f-this.textMargin,y:e},{x:f-this.textMargin+d,y:e},{x:f-this.textMargin+d+2*this.textMargin,y:0},{x:f-this.textMargin+2*this.textMargin,y:0},{x:f,y:h}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function m(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.yes_direction="bottom",this.no_direction="right",b.yes&&b.direction_yes&&b.no&&!b.direction_no?"right"===b.direction_yes?(this.no_direction="bottom",this.yes_direction="right"):(this.no_direction="right",this.yes_direction="bottom"):b.yes&&!b.direction_yes&&b.no&&b.direction_no?"right"===b.direction_no?(this.yes_direction="bottom",this.no_direction="right"):(this.yes_direction="right",this.no_direction="bottom"):(this.yes_direction="bottom",this.no_direction="right"),this.yes_direction=this.yes_direction||"bottom",this.no_direction=this.no_direction||"right",this.text.attr({x:2*this.textMargin});var d=this.text.getBBox().width+3*this.textMargin;d+=d/2;var e=this.text.getBBox().height+2*this.textMargin;e+=e/2,e=Math.max(.5*d,e);var f=d/4,h=e/4;this.text.attr({x:f+this.textMargin/2});var i={x:f,y:h},j=[{x:f-d/4,y:h+e/4},{x:f-d/4+d/2,y:h+e/4+e/2},{x:f-d/4+d,y:h+e/4},{x:f-d/4+d/2,y:h+e/4-e/2},{x:f-d/4,y:h+e/4}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function n(a){function b(a){var b=a.indexOf("(")+1,c=a.indexOf(")");return b>=0&&c>=0?d.symbols[a.substring(0,b-1)]:d.symbols[a]}function c(a){var b="next",c=a.indexOf("(")+1,d=a.indexOf(")");return c>=0&&d>=0&&(b=D.substring(c,d),b.indexOf(",")<0&&"yes"!==b&&"no"!==b&&(b="next, "+b)),b}a=a||"",a=a.trim();for(var d={symbols:{},start:null,drawSVG:function(a,b){function c(a){if(g[a.key])return g[a.key];switch(a.symbolType){case"start":g[a.key]=new h(e,a);break;case"end":g[a.key]=new i(e,a);break;case"operation":g[a.key]=new j(e,a);break;case"inputoutput":g[a.key]=new l(e,a);break;case"subroutine":g[a.key]=new k(e,a);break;case"condition":g[a.key]=new m(e,a);break;default:return new Error("Wrong symbol type!")}return g[a.key]}var d=this;this.diagram&&this.diagram.clean();var e=new f(a,b);this.diagram=e;var g={};!function n(a,b,f){var g=c(a);return d.start===a?e.startWith(g):b&&f&&!b.pathOk&&(b instanceof m?(f.yes===a&&b.yes(g),f.no===a&&b.no(g)):b.then(g)),g.pathOk?g:(g instanceof m?(a.yes&&n(a.yes,g,a),a.no&&n(a.no,g,a)):a.next&&n(a.next,g,a),g)}(this.start),e.render()},clean:function(){this.diagram.clean()}},e=[],g=0,n=1,o=a.length;o>n;n++)if("\n"===a[n]&&"\\"!==a[n-1]){var p=a.substring(g,n);g=n+1,e.push(p.replace(/\\\n/g,"\n"))}g<a.length&&e.push(a.substr(g));for(var q=1,r=e.length;r>q;){var s=e[q];s.indexOf(": ")<0&&s.indexOf("(")<0&&s.indexOf(")")<0&&s.indexOf("->")<0&&s.indexOf("=>")<0?(e[q-1]+="\n"+s,e.splice(q,1),r--):q++}for(;e.length>0;){var t=e.splice(0,1)[0];if(t.indexOf("=>")>=0){var u,v=t.split("=>"),w={key:v[0],symbolType:v[1],text:null,link:null,target:null,flowstate:null};if(w.symbolType.indexOf(": ")>=0&&(u=w.symbolType.split(": "),w.symbolType=u[0],w.text=u[1]),w.text&&w.text.indexOf(":>")>=0?(u=w.text.split(":>"),w.text=u[0],w.link=u[1]):w.symbolType.indexOf(":>")>=0&&(u=w.symbolType.split(":>"),w.symbolType=u[0],w.link=u[1]),w.symbolType.indexOf("\n")>=0&&(w.symbolType=w.symbolType.split("\n")[0]),w.link){var x=w.link.indexOf("[")+1,y=w.link.indexOf("]");x>=0&&y>=0&&(w.target=w.link.substring(x,y),w.link=w.link.substring(0,x-1))}if(w.text&&w.text.indexOf("|")>=0){var z=w.text.split("|");w.text=z[0],w.flowstate=z[1].trim()}d.symbols[w.key]=w}else if(t.indexOf("->")>=0)for(var A=t.split("->"),B=0,C=A.length;C>B;B++){var D=A[B],E=b(D),F=c(D),G=null;if(F.indexOf(",")>=0){var H=F.split(",");F=H[0],G=H[1].trim()}if(d.start||(d.start=E),C>B+1){var I=A[B+1];E[F]=b(I),E["direction_"+F]=G,G=null}}}return d}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o=this,p={};"undefined"!=typeof module&&module.exports?module.exports=p:o.flowchart=o.flowchart||p;var q={x:0,y:0,"line-width":3,"line-length":50,"text-margin":10,"font-size":14,"font-color":"black","line-color":"black","element-color":"black",fill:"white","yes-text":"yes","no-text":"no","arrow-end":"block","class":"flowchart",symbols:{start:{},end:{},condition:{},inputoutput:{},operation:{},subroutine:{}}},r={defaults:a,inherits:b};f.prototype.handle=function(a){this.symbols.indexOf(a)<=-1&&this.symbols.push(a);var b=this;return a instanceof m?(a.yes=function(c){return a.yes_symbol=c,a.no_symbol&&(a.pathOk=!0),b.handle(c)},a.no=function(c){return a.no_symbol=c,a.yes_symbol&&(a.pathOk=!0),b.handle(c)}):a.then=function(c){return a.next=c,a.pathOk=!0,b.handle(c)},a},f.prototype.startWith=function(a){return this.start=a,this.handle(a)},f.prototype.render=function(){var a,b=0,c=0,d=0,e=0,f=0,g=0;for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.width>b&&(b=a.width),a.height>c&&(c=a.height);for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.shiftX(this.options.x+(b-a.width)/2+this.options["line-width"]),a.shiftY(this.options.y+(c-a.height)/2+this.options["line-width"]);for(this.start.render(),d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.renderLines();for(f=this.maxXFromLine,d=0,e=this.symbols.length;e>d;d++){a=this.symbols[d];var h=a.getX()+a.width,i=a.getY()+a.height;h>f&&(f=h),i>g&&(g=i)}this.paper.setSize(f+this.options["line-width"],g+this.options["line-width"])},f.prototype.clean=function(){if(this.paper){var a=this.paper.canvas;a.parentNode.removeChild(a)}},g.prototype.getAttr=function(a){if(!this.chart)return void 0;var b,c=this.chart.options?this.chart.options[a]:void 0,d=this.chart.options.symbols?this.chart.options.symbols[this.symbolType][a]:void 0;return this.chart.options.flowstate&&this.chart.options.flowstate[this.flowstate]&&(b=this.chart.options.flowstate[this.flowstate][a]),b||d||c},g.prototype.initialize=function(){this.group.transform("t"+this.getAttr("line-width")+","+this.getAttr("line-width")),this.width=this.group.getBBox().width,this.height=this.group.getBBox().height},g.prototype.getCenter=function(){return{x:this.getX()+this.width/2,y:this.getY()+this.height/2}},g.prototype.getX=function(){return this.group.getBBox().x},g.prototype.getY=function(){return this.group.getBBox().y},g.prototype.shiftX=function(a){this.group.transform("t"+(this.getX()+a)+","+this.getY())},g.prototype.setX=function(a){this.group.transform("t"+a+","+this.getY())},g.prototype.shiftY=function(a){this.group.transform("t"+this.getX()+","+(this.getY()+a))},g.prototype.setY=function(a){this.group.transform("t"+this.getX()+","+a)},g.prototype.getTop=function(){var a=this.getY(),b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getBottom=function(){var a=this.getY()+this.height,b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX();return{x:b,y:a}},g.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width;return{x:b,y:a}},g.prototype.render=function(){if(this.next){var a=this.getAttr("line-length");if("right"===this.next_direction){var b=this.getRight();if(this.next.getLeft(),!this.next.isPositioned){this.next.setY(b.y-this.next.height/2),this.next.shiftX(this.group.getBBox().x+this.width+a);var c=this;!function e(){for(var b,d=!1,f=0,g=c.chart.symbols.length;g>f;f++){b=c.chart.symbols[f];var h=Math.abs(b.getCenter().x-c.next.getCenter().x);if(b.getCenter().y>c.next.getCenter().y&&h<=c.next.width/2){d=!0;break}}d&&(c.next.setX(b.getX()+b.width+a),e())}(),this.next.isPositioned=!0,this.next.render()}}else{var d=this.getBottom();this.next.getTop(),this.next.isPositioned||(this.next.shiftY(this.getY()+this.height+a),this.next.setX(d.x-this.next.width/2),this.next.isPositioned=!0,this.next.render())}}},g.prototype.renderLines=function(){this.next&&(this.next_direction?this.drawLineTo(this.next,"",this.next_direction):this.drawLineTo(this.next))},g.prototype.drawLineTo=function(a,b,c){this.connectedTo.indexOf(a)<0&&this.connectedTo.push(a);var f,g=this.getCenter().x,h=this.getCenter().y,i=(this.getTop(),this.getRight()),j=this.getBottom(),k=this.getLeft(),l=a.getCenter().x,m=a.getCenter().y,n=a.getTop(),o=a.getRight(),p=(a.getBottom(),a.getLeft()),q=g===l,r=h===m,s=m>h,t=h>m,u=g>l,v=l>g,w=0,x=this.getAttr("line-length"),y=this.getAttr("line-width");if(c&&"bottom"!==c||!q||!s)if(c&&"right"!==c||!r||!v)if(c&&"left"!==c||!r||!u)if(c&&"right"!==c||!q||!t)if(c&&"right"!==c||!q||!s)if(c&&"bottom"!==c||!u)if(c&&"bottom"!==c||!v)if(c&&"right"===c&&u)f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"right"===c&&v)f=d(this.chart,i,[{x:n.x,y:i.y},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"bottom"===c&&q&&t)f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:i.x+x/2,y:j.y+x/2},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+x/2;else if("left"===c&&q&&t){var z=k.x-x/2;p.x<k.x&&(z=p.x-x/2),f=d(this.chart,k,[{x:z,y:k.y},{x:z,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x}else"left"===c&&(f=d(this.chart,k,[{x:n.x+(k.x-n.x)/2,y:k.y},{x:n.x+(k.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x);else f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=this.leftEnd&&t?d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b):d(this.chart,j,[{x:j.x,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,k,o,b),this.leftStart=!0,a.rightEnd=!0,w=o.x;else f=d(this.chart,i,p,b),this.rightStart=!0,a.leftEnd=!0,w=p.x;else f=d(this.chart,j,n,b),this.bottomStart=!0,a.topEnd=!0,w=j.x;if(f){for(var A=0,B=this.chart.lines.length;B>A;A++)for(var C,D=this.chart.lines[A],E=D.attr("path"),F=f.attr("path"),G=0,H=E.length-1;H>G;G++){var I=[];I.push(["M",E[G][1],E[G][2]]),I.push(["L",E[G+1][1],E[G+1][2]]);for(var J=I[0][1],K=I[0][2],L=I[1][1],M=I[1][2],N=0,O=F.length-1;O>N;N++){var P=[];P.push(["M",F[N][1],F[N][2]]),P.push(["L",F[N+1][1],F[N+1][2]]);var Q=P[0][1],R=P[0][2],S=P[1][1],T=P[1][2],U=e(J,K,L,M,Q,R,S,T);if(U.onLine1&&U.onLine2){var V;R===T?Q>S?(V=["L",U.x+2*y,R],F.splice(N+1,0,V),V=["C",U.x+2*y,R,U.x,R-4*y,U.x-2*y,R],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",U.x-2*y,R],F.splice(N+1,0,V),V=["C",U.x-2*y,R,U.x,R-4*y,U.x+2*y,R],F.splice(N+2,0,V),f.attr("path",F)):R>T?(V=["L",Q,U.y+2*y],F.splice(N+1,0,V),V=["C",Q,U.y+2*y,Q+4*y,U.y,Q,U.y-2*y],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",Q,U.y-2*y],F.splice(N+1,0,V),V=["C",Q,U.y-2*y,Q+4*y,U.y,Q,U.y+2*y],F.splice(N+2,0,V),f.attr("path",F)),N+=2,C+=2}}}this.chart.lines.push(f)}(!this.chart.maxXFromLine||this.chart.maxXFromLine&&w>this.chart.maxXFromLine)&&(this.chart.maxXFromLine=w)},r.inherits(h,g),r.inherits(i,g),r.inherits(j,g),r.inherits(k,g),r.inherits(l,g),l.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.textMargin;return{x:b,y:a}},l.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width-this.textMargin;return{x:b,y:a}},r.inherits(m,g),m.prototype.render=function(){this.yes_direction&&(this[this.yes_direction+"_symbol"]=this.yes_symbol),this.no_direction&&(this[this.no_direction+"_symbol"]=this.no_symbol);var a=this.getAttr("line-length");if(this.bottom_symbol){var b=this.getBottom();this.bottom_symbol.getTop(),this.bottom_symbol.isPositioned||(this.bottom_symbol.shiftY(this.getY()+this.height+a),this.bottom_symbol.setX(b.x-this.bottom_symbol.width/2),this.bottom_symbol.isPositioned=!0,this.bottom_symbol.render())}if(this.right_symbol){var c=this.getRight();if(this.right_symbol.getLeft(),!this.right_symbol.isPositioned){this.right_symbol.setY(c.y-this.right_symbol.height/2),this.right_symbol.shiftX(this.group.getBBox().x+this.width+a);var d=this;!function e(){for(var b,c=!1,f=0,g=d.chart.symbols.length;g>f;f++){b=d.chart.symbols[f];var h=Math.abs(b.getCenter().x-d.right_symbol.getCenter().x);if(b.getCenter().y>d.right_symbol.getCenter().y&&h<=d.right_symbol.width/2){c=!0;break}}c&&(d.right_symbol.setX(b.getX()+b.width+a),e())}(),this.right_symbol.isPositioned=!0,this.right_symbol.render()}}},m.prototype.renderLines=function(){this.yes_symbol&&this.drawLineTo(this.yes_symbol,this.getAttr("yes-text"),this.yes_direction),this.no_symbol&&this.drawLineTo(this.no_symbol,this.getAttr("no-text"),this.no_direction)},p.parse=n}();
</script>
<script type="text/javascript">
(function (win, doc) {
  function onReady(fn) {
    if (doc.addEventListener) {
      doc.addEventListener('DOMContentLoaded', fn);
    } else {
      doc.attachEvent('onreadystatechange', function() {
        if (doc.readyState === 'interactive')
          fn();
      });
    }
  }

  win.convertUML = function(className, converter, settings) {
    var charts = doc.querySelectorAll("pre." + className),
        arr = [],
        i, j, maxItem, diagaram, text, curNode;

    // Is there a settings object?
    if (settings === void 0) {
        settings = {};
    }

    // Make sure we are dealing with an array
    for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i])

    // Find the UML source element and get the text
    for (i = 0, maxItem = arr.length; i < maxItem; i++) {
        childEl = arr[i].firstChild;
        parentEl = childEl.parentNode;
        text = "";
        for (j = 0; j < childEl.childNodes.length; j++) {
            curNode = childEl.childNodes[j];
            whitespace = /^\s*$/;
            if (curNode.nodeName === "#text" && !(whitespace.test(curNode.nodeValue))) {
                text = curNode.nodeValue;
                break;
            }
        }

        // Do UML conversion and replace source
        el = doc.createElement('div');
        el.className = className;
        parentEl.parentNode.insertBefore(el, parentEl);
        parentEl.parentNode.removeChild(parentEl);
        diagram = converter.parse(text);
        diagram.drawSVG(el, settings);
    }
  }

  onReady(function(){convertUML('uml-flowchart', flowchart);});
  onReady(function(){convertUML('uml-sequence-diagram', Diagram, {theme: 'simple'});});
})(window, document)
</script>
<title>javascript-codechrysalis</title></head><body><article class="markdown-body"><h1 id="javascript-codechrysalis">JavaScript Codechrysalis</h1>

<ul>
<li><a href="#1-chapter-3-functions">1. Chapter 3: Functions</a>
<ul>
<li><a href="#11-math-power-function">1.1. Math Power Function</a></li>
<li><a href="#12-scope">1.2. Scope</a></li>
<li><a href="#13-function-declaration-notation">1.3. Function Declaration Notation</a></li>
<li><a href="#14-closure">1.4. Closure</a></li>
<li><a href="#15-recursion">1.5. Recursion</a></li>
<li><a href="#16-growing-functions">1.6. Growing Functions</a></li>
<li><a href="#17-exercises">1.7. Exercises</a></li>
</ul>
</li>
<li><a href="#2-chapter-4-data-structures---objects-and-arrays">2. Chapter 4: Data Structures - Objects and Arrays</a>
<ul>
<li><a href="#21-properties">2.1. Properties</a></li>
<li><a href="#22-objects">2.2. Objects</a></li>
<li><a href="#23-exercises">2.3. Exercises</a></li>
</ul>
</li>
<li><a href="#3-chapter-5-higher-order-functions">3. Chapter 5: Higher-Order Functions</a>
<ul>
<li><a href="#31-higher-order-functions">3.1. Higher-Order Functions</a></li>
<li><a href="#32-json">3.2. JSON</a></li>
<li><a href="#33-methods-of-functions">3.3. Methods of Functions</a></li>
<li><a href="#34-exercises">3.4. Exercises</a></li>
</ul>
</li>
<li><a href="#4-chapter-6-the-secret-life-of-objects">4. Chapter 6: The Secret Life of Objects</a>
<ul>
<li><a href="#41-encapsulation">4.1. Encapsulation</a></li>
<li><a href="#42-this">4.2. <code>this</code></a></li>
<li><a href="#43-prototype">4.3. Prototype</a></li>
<li><a href="#44-constructors">4.4. Constructors</a></li>
<li><a href="#45-overriding-derived-properties">4.5. Overriding derived properties</a></li>
<li><a href="#46-prototype-interference">4.6. Prototype interference</a></li>
<li><a href="#47-prototype-less-objects">4.7. Prototype-less Objects</a></li>
<li><a href="#48-polymorphism">4.8. Polymorphism</a></li>
<li><a href="#49-getters-and-setters">4.9. Getters and Setters</a></li>
<li><a href="#410-inheritance">4.10. Inheritance</a></li>
<li><a href="#411-the-instanceof-operator">4.11. The <code>instanceof</code> Operator</a></li>
<li><a href="#412-examples">4.12. Examples</a></li>
</ul>
</li>
</ul>

<h1 id="1-chapter-3-functions">1. Chapter 3: Functions</h1>
<h2 id="11-math-power-function">1.1. Math Power Function</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">power</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">base</span>, <span class="pl-smi">exponent</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-c1">1</span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> count <span class="pl-k">=</span> <span class="pl-c1">0</span>; count <span class="pl-k">&lt;</span> exponent; count<span class="pl-k">++</span>)
    result <span class="pl-k">*=</span> base;
  <span class="pl-k">return</span> result;
};

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">power</span>(<span class="pl-c1">2</span>, <span class="pl-c1">10</span>));
<span class="pl-c"><span class="pl-c">//</span> → 1024</span></pre></div>
<h2 id="12-scope">1.2. Scope</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> x <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>outside<span class="pl-pds">"</span></span>;

<span class="pl-k">var</span> <span class="pl-en">f1</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">var</span> x <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>inside f1<span class="pl-pds">"</span></span>;
};
<span class="pl-en">f1</span>();
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(x);
<span class="pl-c"><span class="pl-c">//</span> → outside</span>

<span class="pl-k">var</span> <span class="pl-en">f2</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  x <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>inside f2<span class="pl-pds">"</span></span>;
};
<span class="pl-en">f2</span>();
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(x);
<span class="pl-c"><span class="pl-c">//</span> → inside f2</span></pre></div>
<h3 id="121-nested-scope">1.2.1. Nested Scope</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">landscape</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> <span class="pl-en">flat</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">size</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> count <span class="pl-k">=</span> <span class="pl-c1">0</span>; count <span class="pl-k">&lt;</span> size; count<span class="pl-k">++</span>)
    result <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>_<span class="pl-pds">"</span></span>;
  };
  <span class="pl-k">var</span> <span class="pl-en">mountain</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">size</span>) {
  result <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> count <span class="pl-k">=</span> <span class="pl-c1">0</span>; count <span class="pl-k">&lt;</span> size; count<span class="pl-k">++</span>)
    result <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>'<span class="pl-pds">"</span></span>;
  result <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\\</span><span class="pl-pds">"</span></span>;
  };

  <span class="pl-en">flat</span>(<span class="pl-c1">3</span>);
  <span class="pl-en">mountain</span>(<span class="pl-c1">4</span>);
  <span class="pl-en">flat</span>(<span class="pl-c1">6</span>);
  <span class="pl-en">mountain</span>(<span class="pl-c1">1</span>);
  <span class="pl-en">flat</span>(<span class="pl-c1">1</span>);
  <span class="pl-k">return</span> result;
};

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">landscape</span>());
<span class="pl-c"><span class="pl-c">//</span> → ___/''''\______/'\_</span></pre></div>
<p>The flat and mountain functions can “see” the variable called result, since they are inside the function that defines it. But they cannot see each other’s count variables since they are outside each other’s scope. The environment outside of the landscape function doesn’t see any of the variables defined inside landscape.</p>
<p>In short, each local scope can also see all the local scopes that contain it. The set of variables visible inside a function is determined by the place of that function in the program text. All variables from blocks around a function’s definition are visible—meaning both those in function bodies that enclose it and those at the top level of the program. This approach to variable visibility is called lexical scoping.</p>
<h2 id="13-function-declaration-notation">1.3. Function Declaration Notation</h2>
<p>Function declarations are not part of the regular top-to-bottom flow of control. They are conceptually moved to the top of their scope and can be used by all the code in that scope. This is sometimes useful because it gives us the freedom to order code in a way that seems meaningful, without worrying about having to define all functions above their first use.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>The future says:<span class="pl-pds">"</span></span>, <span class="pl-en">future</span>());

<span class="pl-k">function</span> <span class="pl-en">future</span>() {
  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>We STILL have no flying cars.<span class="pl-pds">"</span></span>;
}</pre></div>
<h2 id="14-closure">1.4. Closure</h2>
<p>A closure is a function that makes use of <em>variables defined in outer functions</em> that have previously returned (local variables really are re-created for every call)</p>
<p>This feature — being able to reference a specific instance of local variables in an enclosing function — is called <em>closure</em>. A function that “closes over” some local variables is called a closure.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">multiplier</span>(<span class="pl-smi">factor</span>) {
  <span class="pl-k">return</span> <span class="pl-k">function</span>(<span class="pl-smi">number</span>) {
      <span class="pl-k">return</span> number <span class="pl-k">*</span> factor;
  };
}

<span class="pl-k">var</span> twice <span class="pl-k">=</span> <span class="pl-en">multiplier</span>(<span class="pl-c1">2</span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">twice</span>(<span class="pl-c1">5</span>));
<span class="pl-c"><span class="pl-c">//</span> → 10</span></pre></div>
<p>Thinking about programs like this takes some practice. A good mental model is to think of the <code>function</code> keyword as “freezing” the code in its body and wrapping it into a package (the function value). So when you read return <code>function(...) {...}</code>, think of it as returning a handle to a piece of computation, frozen for later use.</p>
<p>In the example, <code>multiplier</code> returns a frozen chunk of code that gets stored in the <code>twice</code> variable. The last line then calls the value in this variable, causing the frozen code (return <code>number * factor;</code>) to be activated. It still has access to the <code>factor</code> variable from the <code>multiplier</code> call that created it, and in addition it gets access to the argument passed when unfreezing it, 5, through its <code>number</code> parameter.</p>
<h2 id="15-recursion">1.5. Recursion</h2>
<p>It is perfectly okay for a function to call itself, as long as it takes care not to overflow the stack. A function that calls itself is called recursive. Recursion allows some functions to be written in a different style.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">power</span>(<span class="pl-smi">base</span>, <span class="pl-smi">exponent</span>) {
  <span class="pl-k">if</span> (exponent <span class="pl-k">==</span> <span class="pl-c1">0</span>)
    <span class="pl-k">return</span> <span class="pl-c1">1</span>;
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> base <span class="pl-k">*</span> <span class="pl-en">power</span>(base, exponent <span class="pl-k">-</span> <span class="pl-c1">1</span>);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">power</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>));
<span class="pl-c"><span class="pl-c">//</span> → 8</span></pre></div>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">findSolution</span>(<span class="pl-smi">target</span>) {
  <span class="pl-k">function</span> <span class="pl-en">find</span>(<span class="pl-smi">current</span>, <span class="pl-smi">history</span>) {
    <span class="pl-k">if</span> (current <span class="pl-k">==</span> target)
      <span class="pl-k">return</span> history;
    <span class="pl-k">else</span> <span class="pl-k">if</span> (current <span class="pl-k">&gt;</span> target)
      <span class="pl-k">return</span> <span class="pl-c1">null</span>;
    <span class="pl-k">else</span>
      <span class="pl-k">return</span> <span class="pl-en">find</span>(current <span class="pl-k">+</span> <span class="pl-c1">5</span>, <span class="pl-s"><span class="pl-pds">"</span>(<span class="pl-pds">"</span></span> <span class="pl-k">+</span> history <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> + 5)<span class="pl-pds">"</span></span>) <span class="pl-k">||</span> <span class="pl-en">find</span>(current <span class="pl-k">*</span> <span class="pl-c1">3</span>, <span class="pl-s"><span class="pl-pds">"</span>(<span class="pl-pds">"</span></span> <span class="pl-k">+</span> history <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> * 3)<span class="pl-pds">"</span></span>);
    }
  <span class="pl-k">return</span> <span class="pl-en">find</span>(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">findSolution</span>(<span class="pl-c1">24</span>));
<span class="pl-c"><span class="pl-c">//</span> → (((1 * 3) + 5) * 3)</span></pre></div>
<pre><code>find(1, "1")
  find(6, "(1 + 5)")
    find(11, "((1 + 5) + 5)")
      find(16, "(((1 + 5) + 5) + 5)")
        too big
      find(33, "(((1 + 5) + 5) * 3)")
        too big
    find(18, "((1 + 5) * 3)")
      too big
  find(3, "(1 * 3)")
    find(8, "((1 * 3) + 5)")
      find(13, "(((1 * 3) + 5) + 5)")
        found!
</code></pre>
<h2 id="16-growing-functions">1.6. Growing Functions</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">zeroPad</span>(<span class="pl-smi">number</span>, <span class="pl-smi">width</span>) {
  <span class="pl-k">var</span> string <span class="pl-k">=</span> <span class="pl-c1">String</span>(number);
  <span class="pl-k">while</span> (<span class="pl-smi">string</span>.<span class="pl-c1">length</span> <span class="pl-k">&lt;</span> width)
    string <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-k">+</span> string;
  <span class="pl-k">return</span> string;
}

<span class="pl-k">function</span> <span class="pl-en">printFarmInventory</span>(<span class="pl-smi">cows</span>, <span class="pl-smi">chickens</span>, <span class="pl-smi">pigs</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">zeroPad</span>(cows, <span class="pl-c1">3</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> Cows<span class="pl-pds">"</span></span>);
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">zeroPad</span>(chickens, <span class="pl-c1">3</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> Chickens<span class="pl-pds">"</span></span>);
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">zeroPad</span>(pigs, <span class="pl-c1">3</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> Pigs<span class="pl-pds">"</span></span>);
}

<span class="pl-en">printFarmInventory</span>(<span class="pl-c1">7</span>, <span class="pl-c1">16</span>, <span class="pl-c1">3</span>);</pre></div>
<h2 id="17-exercises">1.7. Exercises</h2>
<h3 id="171-minimum">1.7.1. Minimum</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">min</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {
  <span class="pl-k">if</span> (a <span class="pl-k">&lt;</span> b)
    <span class="pl-k">return</span> a;
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> b;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">min</span>(<span class="pl-c1">0</span>, <span class="pl-c1">10</span>));
<span class="pl-c"><span class="pl-c">//</span> → 0</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">min</span>(<span class="pl-c1">0</span>, <span class="pl-k">-</span><span class="pl-c1">10</span>));
<span class="pl-c"><span class="pl-c">//</span> → -10</span></pre></div>
<h3 id="172-recursion">1.7.2. Recursion</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">isEven</span>(<span class="pl-smi">n</span>) {
  <span class="pl-k">if</span> (n <span class="pl-k">==</span> <span class="pl-c1">0</span>)
    <span class="pl-k">return</span> <span class="pl-c1">true</span>;
  <span class="pl-k">else</span> <span class="pl-k">if</span> (n <span class="pl-k">==</span> <span class="pl-c1">1</span>)
    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  <span class="pl-k">else</span> <span class="pl-k">if</span> (n <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>)
    <span class="pl-k">return</span> <span class="pl-en">isEven</span>(<span class="pl-k">-</span>n);
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> <span class="pl-en">isEven</span>(n <span class="pl-k">-</span> <span class="pl-c1">2</span>);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">isEven</span>(<span class="pl-c1">50</span>));
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">isEven</span>(<span class="pl-c1">75</span>));
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">isEven</span>(<span class="pl-k">-</span><span class="pl-c1">1</span>));
<span class="pl-c"><span class="pl-c">//</span> → false</span></pre></div>
<h3 id="173-bean-counting">1.7.3. Bean Counting</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">countChar</span>(<span class="pl-smi">string</span>, <span class="pl-smi">ch</span>) {
  <span class="pl-k">var</span> counted <span class="pl-k">=</span> <span class="pl-c1">0</span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">string</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)
    <span class="pl-k">if</span> (<span class="pl-smi">string</span>.<span class="pl-c1">charAt</span>(i) <span class="pl-k">==</span> ch)
      counted <span class="pl-k">+=</span> <span class="pl-c1">1</span>;
  <span class="pl-k">return</span> counted;
}

<span class="pl-k">function</span> <span class="pl-en">countBs</span>(<span class="pl-smi">string</span>) {
  <span class="pl-k">return</span> <span class="pl-en">countChar</span>(string, <span class="pl-s"><span class="pl-pds">"</span>B<span class="pl-pds">"</span></span>);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">countBs</span>(<span class="pl-s"><span class="pl-pds">"</span>BBC<span class="pl-pds">"</span></span>));
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">countChar</span>(<span class="pl-s"><span class="pl-pds">"</span>kakkerlak<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>k<span class="pl-pds">"</span></span>));
<span class="pl-c"><span class="pl-c">//</span> → 4</span></pre></div>
<h1 id="2-chapter-4-data-structures---objects-and-arrays">2. Chapter 4: Data Structures - Objects and Arrays</h1>
<p>Objects tend to use names for their properties and store more or less a fixed set of them. Arrays, on the other hand, usually contain varying numbers of conceptually identical values and use numbers (starting from 0) as the names of their properties.</p>
<h2 id="21-properties">2.1. Properties</h2>
<p>Properties that contain functions are generally called <em>methods</em>.</p>
<p>Properties are accessed using <code>value.propName</code> or <code>value["propName"]</code>.</p>
<h3 id="211-array-properties">2.1.1. Array Properties</h3>
<ul>
<li><code>.length</code></li>
<li><code>.push</code></li>
<li><code>.pop</code></li>
<li><code>.join</code></li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> mack <span class="pl-k">=</span> [];
<span class="pl-smi">mack</span>.<span class="pl-c1">push</span>(<span class="pl-s"><span class="pl-pds">"</span>Mack<span class="pl-pds">"</span></span>);
<span class="pl-smi">mack</span>.<span class="pl-c1">push</span>(<span class="pl-s"><span class="pl-pds">"</span>the<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Knife<span class="pl-pds">"</span></span>);

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(mack);
<span class="pl-c"><span class="pl-c">//</span> → ["Mack", "the", "Knife"]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">mack</span>.<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>));
<span class="pl-c"><span class="pl-c">//</span> → Mack the Knife</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">mack</span>.<span class="pl-c1">pop</span>());
<span class="pl-c"><span class="pl-c">//</span> → Knife</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(mack);
<span class="pl-c"><span class="pl-c">//</span> → ["Mack", "the"]</span></pre></div>
<ul>
<li><code>.shift</code> (removing things at the start)</li>
<li><code>.unshift</code> (adding things at the start)</li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> todoList <span class="pl-k">=</span> [];
<span class="pl-k">function</span> <span class="pl-en">rememberTo</span>(<span class="pl-smi">task</span>) {
  <span class="pl-smi">todoList</span>.<span class="pl-c1">push</span>(task);
}
<span class="pl-k">function</span> <span class="pl-en">whatIsNext</span>() {
  <span class="pl-k">return</span> <span class="pl-smi">todoList</span>.<span class="pl-c1">shift</span>();
}
<span class="pl-k">function</span> <span class="pl-en">urgentlyRememberTo</span>(<span class="pl-smi">task</span>) {
  <span class="pl-smi">todoList</span>.<span class="pl-c1">unshift</span>(task);
}</pre></div>
<ul>
<li><code>.indexOf</code> (starts searching at the front of the array)</li>
<li><code>.lastIndexOf</code> (starts searching for the given element at the end of the array)</li>
</ul>
<p>Both indexOf and lastIndexOf take an optional second argument that indicates where to start searching from.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>([<span class="pl-c1">0</span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>].<span class="pl-c1">slice</span>(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>));
<span class="pl-c"><span class="pl-c">//</span> → [2, 3]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>([<span class="pl-c1">0</span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>].<span class="pl-c1">slice</span>(<span class="pl-c1">2</span>));
<span class="pl-c"><span class="pl-c">//</span> → [2, 3, 4]</span></pre></div>
<ul>
<li><code>.slice</code></li>
<li><code>.concat</code></li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">remove</span>(<span class="pl-smi">array</span>, <span class="pl-smi">index</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">array</span>.<span class="pl-c1">slice</span>(<span class="pl-c1">0</span>, index)
        .<span class="pl-c1">concat</span>(<span class="pl-smi">array</span>.<span class="pl-c1">slice</span>(index <span class="pl-k">+</span> <span class="pl-c1">1</span>));
}
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">remove</span>([<span class="pl-s"><span class="pl-pds">"</span>a<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>b<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>c<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>e<span class="pl-pds">"</span></span>], <span class="pl-c1">2</span>));
<span class="pl-c"><span class="pl-c">//</span> → ["a", "b", "d", "e"]</span></pre></div>
<h3 id="212-string-properties">2.1.2. String Properties</h3>
<ul>
<li>
<p><code>.toUpperCase</code></p>
</li>
<li>
<p><code>.toLowerCase</code></p>
</li>
<li>
<p><code>.slice</code></p>
</li>
<li>
<p><code>.indexOf</code> (One difference is that a string’s indexOf can take a string containing more than one character, whereas the corresponding array method looks only for a single element.)</p>
</li>
<li>
<p><code>.length</code></p>
</li>
<li>
<p><code>.charAt</code> (Accessing the individual characters in a string)</p>
</li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> string <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">string</span>.<span class="pl-c1">length</span>);
<span class="pl-c"><span class="pl-c">//</span> → 3</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">string</span>.<span class="pl-c1">charAt</span>(<span class="pl-c1">0</span>));
<span class="pl-c"><span class="pl-c">//</span> → a</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(string[<span class="pl-c1">1</span>]);
<span class="pl-c"><span class="pl-c">//</span> → b</span></pre></div>
<h2 id="22-objects">2.2. Objects</h2>
<p>The <code>in</code> operator can be used to find out whether an object contains a property with a given name.</p>
<p>The same keyword can also be used in a <code>for</code> loop (<code>for (var name in object)</code>) to loop over an object’s properties.</p>
<h3 id="221-delete-operator">2.2.1. <code>Delete</code> Operator</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> anObject <span class="pl-k">=</span> {left<span class="pl-k">:</span> <span class="pl-c1">1</span>, right<span class="pl-k">:</span> <span class="pl-c1">2</span>};
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">anObject</span>.<span class="pl-c1">left</span>);
<span class="pl-c"><span class="pl-c">//</span> → 1</span>
<span class="pl-k">delete</span> <span class="pl-smi">anObject</span>.<span class="pl-c1">left</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">anObject</span>.<span class="pl-c1">left</span>);
<span class="pl-c"><span class="pl-c">//</span> → undefined</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>left<span class="pl-pds">"</span></span> <span class="pl-k">in</span> anObject);
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>right<span class="pl-pds">"</span></span> <span class="pl-k">in</span> anObject);
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<h3 id="222-mutability">2.2.2. Mutability</h3>
<p>We’ve seen that object values can be modified. The types of values discussed in earlier chapters, such as numbers, strings, and Booleans, are all immutable—it is impossible to change an existing value of those types. You can combine them and derive new values from them, but when you take a specific string value, that value will always remain the same. The text inside it cannot be changed. If you have reference to a string that contains "cat", it is not possible for other code to change a character in that string to make it spell "rat".</p>
<p>With objects, on the other hand, the content of a value can be modified by changing its properties.</p>
<p>When we have two numbers, 120 and 120, we can consider them precisely the same number, whether or not they refer to the same physical bits. But with objects, there is a difference between having two references to the same object and having two different objects that contain the same properties. Consider the following code:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> object1 <span class="pl-k">=</span> {value<span class="pl-k">:</span> <span class="pl-c1">10</span>};
<span class="pl-k">var</span> object2 <span class="pl-k">=</span> object1;
<span class="pl-k">var</span> object3 <span class="pl-k">=</span> {value<span class="pl-k">:</span> <span class="pl-c1">10</span>};

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(object1 <span class="pl-k">==</span> object2);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(object1 <span class="pl-k">==</span> object3);
<span class="pl-c"><span class="pl-c">//</span> → false</span>

<span class="pl-smi">object1</span>.<span class="pl-c1">value</span> <span class="pl-k">=</span> <span class="pl-c1">15</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">object2</span>.<span class="pl-c1">value</span>);
<span class="pl-c"><span class="pl-c">//</span> → 15</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">object3</span>.<span class="pl-c1">value</span>);
<span class="pl-c"><span class="pl-c">//</span> → 10</span></pre></div>
<p>Values of type string, number, and Boolean are not objects, and though the language doesn’t complain if you try to set new properties on them, it doesn’t actually store those properties. The values are immutable and cannot be changed.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> myString <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Fido<span class="pl-pds">"</span></span>;
<span class="pl-smi">myString</span>.<span class="pl-smi">myProperty</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">myString</span>.<span class="pl-smi">myProperty</span>);
<span class="pl-c"><span class="pl-c">//</span> → undefined</span></pre></div>
<h3 id="223-objects-as-maps">2.2.3. Objects as Maps</h3>
<p>A <em>map</em> is a way to go from values in one domain (in this case, event names) to corresponding values in another domain (in this case, phi coefficients).</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> map <span class="pl-k">=</span> {};
<span class="pl-k">function</span> <span class="pl-en">storePhi</span>(<span class="pl-c1">event</span>, <span class="pl-smi">phi</span>) {
  map[<span class="pl-c1">event</span>] <span class="pl-k">=</span> phi;
}

<span class="pl-en">storePhi</span>(<span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span>, <span class="pl-c1">0.069</span>);
<span class="pl-en">storePhi</span>(<span class="pl-s"><span class="pl-pds">"</span>touched tree<span class="pl-pds">"</span></span>, <span class="pl-k">-</span><span class="pl-c1">0.081</span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span> <span class="pl-k">in</span> map);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(map[<span class="pl-s"><span class="pl-pds">"</span>touched tree<span class="pl-pds">"</span></span>]);
<span class="pl-c"><span class="pl-c">//</span> → -0.081</span></pre></div>
<h3 id="224-arguments-object">2.2.4. <code>Arguments</code> Object</h3>
<p>Whenever a function is called, a special variable named arguments is added to the environment in which the function body runs. This variable refers to an object that holds all of the arguments passed to the function.</p>
<p>The arguments object has a length property that tells us the number of arguments that were really passed to the function. It also has a property for each argument, named 0, 1, 2, and so on.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">argumentCounter</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>You gave me<span class="pl-pds">"</span></span>, <span class="pl-c1">arguments</span>.<span class="pl-c1">length</span>, <span class="pl-s"><span class="pl-pds">"</span>arguments.<span class="pl-pds">"</span></span>);
}
<span class="pl-en">argumentCounter</span>(<span class="pl-s"><span class="pl-pds">"</span>Straw man<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Tautology<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Ad hominem<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → You gave me 3 arguments.</span></pre></div>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">addEntry</span>(<span class="pl-smi">squirrel</span>) {
  <span class="pl-k">var</span> entry <span class="pl-k">=</span> {events<span class="pl-k">:</span> [], squirrel<span class="pl-k">:</span> squirrel};
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">1</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">arguments</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)
    <span class="pl-smi">entry</span>.<span class="pl-smi">events</span>.<span class="pl-c1">push</span>(<span class="pl-c1">arguments</span>[i]);
  <span class="pl-smi">journal</span>.<span class="pl-c1">push</span>(entry);
}
<span class="pl-en">addEntry</span>(<span class="pl-c1">true</span>, <span class="pl-s"><span class="pl-pds">"</span>work<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>touched tree<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span>,
         <span class="pl-s"><span class="pl-pds">"</span>running<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>television<span class="pl-pds">"</span></span>);</pre></div>
<h3 id="225-math-object">2.2.5. <code>Math</code> Object</h3>
<ul>
<li><code>Math.max</code></li>
<li><code>Math.min</code></li>
<li><code>Math.sqrt</code></li>
<li><code>Math.cos</code>, <code>Math.sin</code>, <code>Math.tan</code>, <code>Math.acos</code>, <code>Math.asin</code>, <code>Math.atan</code></li>
<li><code>Math.PI</code></li>
<li><code>Math.random</code></li>
<li><code>Math.floor</code>, <code>Math.ceil</code>, <code>Math.round</code></li>
</ul>
<h3 id="226-global-object">2.2.6. Global Object</h3>
<p>The global scope, the space in which global variables live, can also be approached as an object in JavaScript. Each global variable is present as a property of this object. In browsers, the global scope object is stored in the <code>window</code>variable.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> myVar <span class="pl-k">=</span> <span class="pl-c1">10</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>myVar<span class="pl-pds">"</span></span> <span class="pl-k">in</span> <span class="pl-c1">window</span>);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">window</span>.<span class="pl-smi">myVar</span>);
<span class="pl-c"><span class="pl-c">//</span> → 10</span></pre></div>
<h2 id="23-exercises">2.3. Exercises</h2>
<h3 id="231-the-sum-of-a-range">2.3.1. The sum of a range</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">sum</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-c1">0</span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
    result <span class="pl-k">+=</span> array[i];
  }
  <span class="pl-k">return</span> result;
}

<span class="pl-k">function</span> <span class="pl-en">range</span>(<span class="pl-smi">start</span>, <span class="pl-smi">end</span>, <span class="pl-smi">step</span>) {
  <span class="pl-k">if</span> (step <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">&amp;&amp;</span> start <span class="pl-k">&lt;=</span> end) {
    step <span class="pl-k">=</span> <span class="pl-c1">1</span>;
  } <span class="pl-k">else</span> <span class="pl-k">if</span> (step <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">&amp;&amp;</span> start <span class="pl-k">&gt;</span> end) {
    step <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>;
  }
  <span class="pl-k">var</span> array <span class="pl-k">=</span> [];
  <span class="pl-k">if</span> (step <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
    <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> start; i <span class="pl-k">&lt;=</span> end; i <span class="pl-k">+=</span> step)
      <span class="pl-smi">array</span>.<span class="pl-c1">push</span>(i);
  } <span class="pl-k">else</span> {
    <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> start; i <span class="pl-k">&gt;=</span> end; i <span class="pl-k">+=</span> step)
      <span class="pl-smi">array</span>.<span class="pl-c1">push</span>(i);
  }
  <span class="pl-k">return</span> array;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">10</span>))
<span class="pl-c"><span class="pl-c">//</span> → [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">range</span>(<span class="pl-c1">5</span>, <span class="pl-c1">2</span>, <span class="pl-k">-</span><span class="pl-c1">1</span>));
<span class="pl-c"><span class="pl-c">//</span> → [5, 4, 3, 2]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">sum</span>(<span class="pl-en">range</span>(<span class="pl-c1">1</span>, <span class="pl-c1">10</span>)));
<span class="pl-c"><span class="pl-c">//</span> → 55</span></pre></div>
<h3 id="232-reversing-an-array">2.3.2. Reversing an array</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">reverseArray</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">var</span> reversed <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>;  i <span class="pl-k">&gt;=</span> <span class="pl-c1">0</span>; i<span class="pl-k">--</span>) {
    <span class="pl-smi">reversed</span>.<span class="pl-c1">push</span>(array[i]);
  }
  <span class="pl-k">return</span> reversed;
}

<span class="pl-k">function</span> <span class="pl-en">reverseArrayInPlace</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">Math</span>.<span class="pl-c1">floor</span>(<span class="pl-smi">array</span>.<span class="pl-c1">length</span><span class="pl-k">/</span><span class="pl-c1">2</span>); i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> temp <span class="pl-k">=</span> array[<span class="pl-smi">array</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span> <span class="pl-k">-</span> i];
    array[<span class="pl-smi">array</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span> <span class="pl-k">-</span> i] <span class="pl-k">=</span> array[i];
    array[i] <span class="pl-k">=</span> temp;
  }
  <span class="pl-k">return</span> array;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">reverseArray</span>([<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>B<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>C<span class="pl-pds">"</span></span>]));
<span class="pl-c"><span class="pl-c">//</span> → ["C", "B", "A"];</span>
<span class="pl-k">var</span> arrayValue <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>];
<span class="pl-en">reverseArrayInPlace</span>(arrayValue);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(arrayValue);
<span class="pl-c"><span class="pl-c">//</span> → [5, 4, 3, 2, 1]</span></pre></div>
<h3 id="233-a-list">2.3.3. A List</h3>
<p>Objects, as generic blobs of values, can be used to build all sorts of data structures. A common data structure is the list (not to be confused with the array). A list is a nested set of objects, with the first object holding a reference to the second, the second to the third, and so on.</p>
<pre><code>var list = {
  value: 1,
  rest: {
    value: 2,
    rest: {
      value: 3,
      rest: null
    }
  }
};
</code></pre>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">arrayToList</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">var</span> list <span class="pl-k">=</span> <span class="pl-c1">null</span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>; i <span class="pl-k">&gt;=</span> <span class="pl-c1">0</span>; i<span class="pl-k">--</span>)
    list <span class="pl-k">=</span> {value<span class="pl-k">:</span> array[i], rest<span class="pl-k">:</span> list};
  <span class="pl-k">return</span> list;
}

<span class="pl-k">function</span> <span class="pl-en">listToArray</span>(<span class="pl-smi">list</span>) {
  <span class="pl-k">var</span> array <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> node <span class="pl-k">=</span> list; node; node <span class="pl-k">=</span> <span class="pl-smi">node</span>.<span class="pl-smi">rest</span>)
    <span class="pl-smi">array</span>.<span class="pl-c1">push</span>(<span class="pl-smi">node</span>.<span class="pl-c1">value</span>);
  <span class="pl-k">return</span> array;
}

<span class="pl-k">function</span> <span class="pl-en">prepend</span>(<span class="pl-smi">value</span>, <span class="pl-smi">list</span>) {
  <span class="pl-k">return</span> {value<span class="pl-k">:</span> value, rest<span class="pl-k">:</span> list};
}

<span class="pl-k">function</span> <span class="pl-en">nth</span>(<span class="pl-smi">list</span>, <span class="pl-smi">n</span>) {
  <span class="pl-k">if</span> (<span class="pl-k">!</span>list)
    <span class="pl-k">return</span> <span class="pl-c1">undefined</span>;
  <span class="pl-k">else</span> <span class="pl-k">if</span> (n <span class="pl-k">==</span> <span class="pl-c1">0</span>)
    <span class="pl-k">return</span> <span class="pl-smi">list</span>.<span class="pl-c1">value</span>;
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> <span class="pl-en">nth</span>(<span class="pl-smi">list</span>.<span class="pl-smi">rest</span>, n <span class="pl-k">-</span> <span class="pl-c1">1</span>);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">arrayToList</span>([<span class="pl-c1">10</span>, <span class="pl-c1">20</span>]));
<span class="pl-c"><span class="pl-c">//</span> → {value: 10, rest: {value: 20, rest: null}}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">listToArray</span>(<span class="pl-en">arrayToList</span>([<span class="pl-c1">10</span>, <span class="pl-c1">20</span>, <span class="pl-c1">30</span>])));
<span class="pl-c"><span class="pl-c">//</span> → [10, 20, 30]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">prepend</span>(<span class="pl-c1">10</span>, <span class="pl-en">prepend</span>(<span class="pl-c1">20</span>, <span class="pl-c1">null</span>)));
<span class="pl-c"><span class="pl-c">//</span> → {value: 10, rest: {value: 20, rest: null}}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">nth</span>(<span class="pl-en">arrayToList</span>([<span class="pl-c1">10</span>, <span class="pl-c1">20</span>, <span class="pl-c1">30</span>]), <span class="pl-c1">1</span>));
<span class="pl-c"><span class="pl-c">//</span> → 20</span></pre></div>
<h3 id="234-deep-comparison">2.3.4. Deep Comparison</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">deepEqual</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {
  <span class="pl-k">if</span> (a <span class="pl-k">===</span> b) <span class="pl-k">return</span> <span class="pl-c1">true</span>;
  
  <span class="pl-k">if</span> (a <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">||</span> <span class="pl-k">typeof</span> a <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">"</span>object<span class="pl-pds">"</span></span> <span class="pl-k">||</span>
      b <span class="pl-k">==</span> <span class="pl-c1">null</span> <span class="pl-k">||</span> <span class="pl-k">typeof</span> b <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">"</span>object<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  
  <span class="pl-k">var</span> propsInA <span class="pl-k">=</span> <span class="pl-c1">0</span>, propsInB <span class="pl-k">=</span> <span class="pl-c1">0</span>;

  <span class="pl-k">for</span> (<span class="pl-k">var</span> prop <span class="pl-k">in</span> a)
    propsInA <span class="pl-k">+=</span> <span class="pl-c1">1</span>;

  <span class="pl-k">for</span> (<span class="pl-k">var</span> prop <span class="pl-k">in</span> b) {
    propsInB <span class="pl-k">+=</span> <span class="pl-c1">1</span>;
    <span class="pl-k">if</span> (<span class="pl-k">!</span>(prop <span class="pl-k">in</span> a) <span class="pl-k">||</span> <span class="pl-k">!</span><span class="pl-en">deepEqual</span>(a[prop], b[prop]))
      <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  }

  <span class="pl-k">return</span> propsInA <span class="pl-k">==</span> propsInB;
}

<span class="pl-k">var</span> obj <span class="pl-k">=</span> {here<span class="pl-k">:</span> {is<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>an<span class="pl-pds">"</span></span>}, object<span class="pl-k">:</span> <span class="pl-c1">2</span>};
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">deepEqual</span>(obj, obj));
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">deepEqual</span>(obj, {here<span class="pl-k">:</span> <span class="pl-c1">1</span>, object<span class="pl-k">:</span> <span class="pl-c1">2</span>}));
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">deepEqual</span>(obj, {here<span class="pl-k">:</span> {is<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>an<span class="pl-pds">"</span></span>}, object<span class="pl-k">:</span> <span class="pl-c1">2</span>}));
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<h1 id="3-chapter-5-higher-order-functions">3. Chapter 5: Higher-Order Functions</h1>
<h2 id="31-higher-order-functions">3.1. Higher-Order Functions</h2>
<p>Arrays provide a number of useful higher-order methods:</p>
<ul>
<li><code>forEach</code> (do something with each element in an array)</li>
<li><code>filter</code>  (build a new array with some elements filtered out)</li>
<li><code>map</code> (build a new array where each element has been put through a function)</li>
<li><code>reduce</code> (combine all an array’s elements into a single value)</li>
<li><code>every</code> (returns true only when the predicate returns true for <strong>all</strong> elements of the array)</li>
<li><code>some</code> (returns true as soon as the predicate returns true for <strong>any</strong> of the elements)</li>
</ul>
<p><strong>Functions that create new functions:</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">greaterThan</span>(<span class="pl-smi">n</span>) {
  <span class="pl-k">return</span> <span class="pl-k">function</span>(<span class="pl-smi">m</span>) { <span class="pl-k">return</span> m <span class="pl-k">&gt;</span> n; };
}
<span class="pl-k">var</span> greaterThan10 <span class="pl-k">=</span> <span class="pl-en">greaterThan</span>(<span class="pl-c1">10</span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">greaterThan10</span>(<span class="pl-c1">11</span>));
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<p><strong>Functions that change other functions:</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">noisy</span>(<span class="pl-smi">f</span>) {
  <span class="pl-k">return</span> <span class="pl-k">function</span>(<span class="pl-smi">arg</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>calling with<span class="pl-pds">"</span></span>, arg);
    <span class="pl-k">var</span> val <span class="pl-k">=</span> <span class="pl-en">f</span>(arg);
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>called with<span class="pl-pds">"</span></span>, arg, <span class="pl-s"><span class="pl-pds">"</span>- got<span class="pl-pds">"</span></span>, val);
    <span class="pl-k">return</span> val;
  };
}
<span class="pl-en">noisy</span>(<span class="pl-c1">Boolean</span>)(<span class="pl-c1">0</span>);
<span class="pl-c"><span class="pl-c">//</span> → calling with 0</span>
<span class="pl-c"><span class="pl-c">//</span> → called with 0 - got false</span></pre></div>
<p><strong>Functions that provide new types of control flow:</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">unless</span>(<span class="pl-smi">test</span>, <span class="pl-smi">then</span>) {
  <span class="pl-k">if</span> (<span class="pl-k">!</span>test) <span class="pl-en">then</span>();
}
<span class="pl-k">function</span> <span class="pl-en">repeat</span>(<span class="pl-smi">times</span>, <span class="pl-smi">body</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> times; i<span class="pl-k">++</span>) <span class="pl-en">body</span>(i);
}

<span class="pl-en">repeat</span>(<span class="pl-c1">3</span>, <span class="pl-k">function</span>(<span class="pl-smi">n</span>) {
  <span class="pl-en">unless</span>(n <span class="pl-k">%</span> <span class="pl-c1">2</span>, <span class="pl-k">function</span>() {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(n, <span class="pl-s"><span class="pl-pds">"</span>is even<span class="pl-pds">"</span></span>);
  });
});
<span class="pl-c"><span class="pl-c">//</span> → 0 is even</span>
<span class="pl-c"><span class="pl-c">//</span> → 2 is even</span></pre></div>
<h3 id="311-foreach">3.1.1. ForEach</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">forEach</span>(<span class="pl-smi">array</span>, <span class="pl-smi">action</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)
    <span class="pl-en">action</span>(array[i]);
}

<span class="pl-en">forEach</span>([<span class="pl-s"><span class="pl-pds">"</span>Wampeter<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Foma<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Granfalloon<span class="pl-pds">"</span></span>], <span class="pl-en">console</span>.<span class="pl-smi">log</span>);
<span class="pl-c"><span class="pl-c">//</span> → Wampeter</span>
<span class="pl-c"><span class="pl-c">//</span> → Foma</span>
<span class="pl-c"><span class="pl-c">//</span> → Granfalloon</span>

<span class="pl-k">var</span> numbers <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>], sum <span class="pl-k">=</span> <span class="pl-c1">0</span>;
<span class="pl-en">forEach</span>(numbers, <span class="pl-k">function</span>(<span class="pl-smi">number</span>) {
  sum <span class="pl-k">+=</span> number;
});
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(sum);
<span class="pl-c"><span class="pl-c">//</span> → 15</span></pre></div>
<h3 id="312-filtering-an-array">3.1.2. Filtering an Array</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">filter</span>(<span class="pl-smi">array</span>, <span class="pl-smi">test</span>) {
  <span class="pl-k">var</span> passed <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
    <span class="pl-k">if</span> (<span class="pl-en">test</span>(array[i]))
      <span class="pl-smi">passed</span>.<span class="pl-c1">push</span>(array[i]);
  }
  <span class="pl-k">return</span> passed;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">filter</span>(ancestry, <span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-smi">born</span> <span class="pl-k">&gt;</span> <span class="pl-c1">1900</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">person</span>.<span class="pl-smi">born</span> <span class="pl-k">&lt;</span> <span class="pl-c1">1925</span>;
}));
<span class="pl-c"><span class="pl-c">//</span> → [{name: "Philibert Haverbeke", …}, …]</span>

<span class="pl-c"><span class="pl-c">//</span> BUILT-IN</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-smi">father</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>Carel Haverbeke<span class="pl-pds">"</span></span>;
}));
<span class="pl-c"><span class="pl-c">//</span> → [{name: "Carolus Haverbeke", …}]</span></pre></div>
<h3 id="313-transforming-with-map">3.1.3. Transforming with <code>map</code></h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">map</span>(<span class="pl-smi">array</span>, <span class="pl-smi">transform</span>) {
  <span class="pl-k">var</span> mapped <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)
    <span class="pl-smi">mapped</span>.<span class="pl-c1">push</span>(<span class="pl-en">transform</span>(array[i]));
  <span class="pl-k">return</span> mapped;
}

<span class="pl-k">var</span> overNinety <span class="pl-k">=</span> <span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-smi">died</span> <span class="pl-k">-</span> <span class="pl-smi">person</span>.<span class="pl-smi">born</span> <span class="pl-k">&gt;</span> <span class="pl-c1">90</span>;
});
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">map</span>(overNinety, <span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-c1">name</span>;
}));
<span class="pl-c"><span class="pl-c">//</span> → ["Clara Aernoudts", "Emile Haverbeke",</span>
<span class="pl-c"><span class="pl-c">//</span>    "Maria Haverbeke"]</span></pre></div>
<h3 id="314-summarizing-with-reduce">3.1.4. Summarizing with <code>reduce</code></h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">reduce</span>(<span class="pl-smi">array</span>, <span class="pl-smi">combine</span>, <span class="pl-smi">start</span>) {
  <span class="pl-k">var</span> current <span class="pl-k">=</span> start;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)
    current <span class="pl-k">=</span> <span class="pl-en">combine</span>(current, array[i]);
  <span class="pl-k">return</span> current;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">reduce</span>([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>], <span class="pl-k">function</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {
  <span class="pl-k">return</span> a <span class="pl-k">+</span> b;
}, <span class="pl-c1">0</span>));
<span class="pl-c"><span class="pl-c">//</span> → 10</span>

<span class="pl-c"><span class="pl-c">//</span> BUILT-IN FUNCTION</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">min</span>, <span class="pl-smi">cur</span>) {
  <span class="pl-k">if</span> (<span class="pl-smi">cur</span>.<span class="pl-smi">born</span> <span class="pl-k">&lt;</span> <span class="pl-smi">min</span>.<span class="pl-smi">born</span>) <span class="pl-k">return</span> cur;
  <span class="pl-k">else</span> <span class="pl-k">return</span> min;
}));
<span class="pl-c"><span class="pl-c">//</span> → {name: "Pauwels van Haverbeke", born: 1535, …}</span>

<span class="pl-c"><span class="pl-c">//</span> As comparison: without higher-order functions</span>
<span class="pl-k">var</span> min <span class="pl-k">=</span> ancestry[<span class="pl-c1">0</span>];
<span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">1</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">ancestry</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
  <span class="pl-k">var</span> cur <span class="pl-k">=</span> ancestry[i];
  <span class="pl-k">if</span> (<span class="pl-smi">cur</span>.<span class="pl-smi">born</span> <span class="pl-k">&lt;</span> <span class="pl-smi">min</span>.<span class="pl-smi">born</span>)
    min <span class="pl-k">=</span> cur;
}
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(min);
<span class="pl-c"><span class="pl-c">//</span> → {name: "Pauwels van Haverbeke", born: 1535, …}</span>

<span class="pl-c"><span class="pl-c">//</span> REDUCE WITH EACH</span>
<span class="pl-k">function</span> <span class="pl-en">each</span>(<span class="pl-smi">array</span>, <span class="pl-smi">callback</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>){
    <span class="pl-en">callback</span>(array[i]);
  }
}

<span class="pl-k">function</span> <span class="pl-en">reduce</span>(<span class="pl-smi">array</span>, <span class="pl-smi">combine</span>, <span class="pl-smi">start</span>){
  <span class="pl-k">var</span> result <span class="pl-k">=</span> start;
  <span class="pl-k">function</span> <span class="pl-en">eachCallback</span>(<span class="pl-smi">curr</span>) {
    result <span class="pl-k">=</span> <span class="pl-en">combine</span>(result, curr);
  }
  <span class="pl-en">each</span>(array, eachCallback)
  <span class="pl-k">return</span> result;

  <span class="pl-c"><span class="pl-c">//</span> var result = start;</span>
  <span class="pl-c"><span class="pl-c">//</span> for (var i = 0; i &lt; array.length; i++)</span>
  <span class="pl-c"><span class="pl-c">//</span>  result = combine(result, array[i]);</span>
  <span class="pl-c"><span class="pl-c">//</span> return result;</span>
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">reduce</span>([<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">4</span>,<span class="pl-c1">5</span>], <span class="pl-k">function</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>){
  <span class="pl-k">return</span> a <span class="pl-k">+</span> b;
}, <span class="pl-c1">0</span>))</pre></div>
<h3 id="315-composing-functions">3.1.5. Composing Functions</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">average</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">function</span> <span class="pl-en">plus</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) { <span class="pl-k">return</span> a <span class="pl-k">+</span> b; }
  <span class="pl-k">return</span> <span class="pl-smi">array</span>.<span class="pl-en">reduce</span>(plus) <span class="pl-k">/</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>;
}
<span class="pl-k">function</span> <span class="pl-en">age</span>(<span class="pl-smi">p</span>) { <span class="pl-k">return</span> <span class="pl-smi">p</span>.<span class="pl-smi">died</span> <span class="pl-k">-</span> <span class="pl-smi">p</span>.<span class="pl-smi">born</span>; }
<span class="pl-k">function</span> <span class="pl-en">male</span>(<span class="pl-smi">p</span>) { <span class="pl-k">return</span> <span class="pl-smi">p</span>.<span class="pl-smi">sex</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>; }
<span class="pl-k">function</span> <span class="pl-en">female</span>(<span class="pl-smi">p</span>) { <span class="pl-k">return</span> <span class="pl-smi">p</span>.<span class="pl-smi">sex</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>; }

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">average</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(male).<span class="pl-en">map</span>(age)));
<span class="pl-c"><span class="pl-c">//</span> → 61.67</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">average</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(female).<span class="pl-en">map</span>(age)));
<span class="pl-c"><span class="pl-c">//</span> → 54.56</span></pre></div>
<h2 id="32-json">3.2. JSON</h2>
<div class="highlight highlight-source-js"><pre>[
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emma de Milliano<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>,
   <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1876</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1956</span>,
   <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petrus de Milliano<span class="pl-pds">"</span></span>,
   <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Sophia van Damme<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carolus Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>,
   <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1832</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1905</span>,
   <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carel Haverbeke<span class="pl-pds">"</span></span>,
   <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria van Brussel<span class="pl-pds">"</span></span>},
  … and so on
]</pre></div>
<p>JavaScript gives us functions, <code>JSON.stringify</code> and <code>JSON.parse</code>, that convert data to and from this format. The first takes a JavaScript value and returns a JSON-encoded string. The second takes such a string and converts it to the value it encodes.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> string <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">stringify</span>({name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>X<span class="pl-pds">"</span></span>, born<span class="pl-k">:</span> <span class="pl-c1">1980</span>});
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(string);
<span class="pl-c"><span class="pl-c">//</span> → {"name":"X","born":1980}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(string).<span class="pl-smi">born</span>);
<span class="pl-c"><span class="pl-c">//</span> → 1980</span></pre></div>
<h2 id="33-methods-of-functions">3.3. Methods of Functions</h2>
<h3 id="331-applying">3.3.1. Applying</h3>
<p><strong>Passing Arguments</strong></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">noisy</span>(<span class="pl-smi">f</span>) {
  <span class="pl-k">return</span> <span class="pl-k">function</span>(<span class="pl-smi">arg</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>calling with<span class="pl-pds">"</span></span>, arg);
    <span class="pl-k">var</span> val <span class="pl-k">=</span> <span class="pl-en">f</span>(arg);
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>called with<span class="pl-pds">"</span></span>, arg, <span class="pl-s"><span class="pl-pds">"</span>- got<span class="pl-pds">"</span></span>, val);
    <span class="pl-k">return</span> val;
  };
}</pre></div>
<p>If <code>f</code> takes more than one parameter, it gets only the first one. We could add a bunch of arguments to the inner function (<code>arg1</code>, <code>arg2</code>, and so on) and pass them all to <code>f</code>, but it is not clear how many would be enough. This solution would also deprive <code>f</code> of the information in <code>arguments.length</code>. Since we’d always pass the same number of arguments, it wouldn’t know how many arguments were originally given.</p>
<p>Functions have an <code>apply</code> method that can be used to call them with an array specifying their arguments. They also have a <code>bind</code> method, which is used to create a partially applied version of the function.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">transparentWrapping</span>(<span class="pl-smi">f</span>) {
  <span class="pl-k">return</span> <span class="pl-k">function</span>() {
    <span class="pl-k">return</span> <span class="pl-smi">f</span>.<span class="pl-c1">apply</span>(<span class="pl-c1">null</span>, <span class="pl-c1">arguments</span>);
  };
}</pre></div>
<h3 id="332-binding">3.3.2. Binding</h3>
<p>The <code>bind</code> method, which all functions have, creates a new function that will call the original function but with some of the arguments already fixed.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> theSet <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">"</span>Carel Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Maria van Brussel<span class="pl-pds">"</span></span>,
              <span class="pl-s"><span class="pl-pds">"</span>Donald Duck<span class="pl-pds">"</span></span>];
<span class="pl-k">function</span> <span class="pl-en">isInSet</span>(<span class="pl-smi">set</span>, <span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">set</span>.<span class="pl-c1">indexOf</span>(<span class="pl-smi">person</span>.<span class="pl-c1">name</span>) <span class="pl-k">&gt;</span> <span class="pl-k">-</span><span class="pl-c1">1</span>;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  <span class="pl-k">return</span> <span class="pl-en">isInSet</span>(theSet, person);
}));
<span class="pl-c"><span class="pl-c">//</span> → [{name: "Maria van Brussel", …},</span>
<span class="pl-c"><span class="pl-c">//</span>    {name: "Carel Haverbeke", …}]</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">ancestry</span>.<span class="pl-en">filter</span>(<span class="pl-smi">isInSet</span>.<span class="pl-en">bind</span>(<span class="pl-c1">null</span>, theSet)));
<span class="pl-c"><span class="pl-c">//</span> → … same result</span></pre></div>
<h2 id="34-exercises">3.4. Exercises</h2>
<h3 id="341-flattening-an-array">3.4.1. Flattening an Array</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> arrays <span class="pl-k">=</span> [[<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>], [<span class="pl-c1">4</span>, <span class="pl-c1">5</span>], [<span class="pl-c1">6</span>]];

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">arrays</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">flatArray</span>, <span class="pl-smi">current</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">flatArray</span>.<span class="pl-c1">concat</span>(current);
},[]));

<span class="pl-c"><span class="pl-c">//</span> → [1, 2, 3, 4, 5, 6]</span></pre></div>
<h3 id="342-mother-child-age-difference">3.4.2. Mother-child age difference</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-c1">ANCESTRY_FILE</span> <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">stringify</span>([
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carolus Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1832</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1905</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carel Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria van Brussel<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emma de Milliano<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1876</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1956</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petrus de Milliano<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Sophia van Damme<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria de Rycke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1683</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1724</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Frederik de Rycke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Laurentia van Vlaenderen<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1714</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1748</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jacobus van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna van Rooten<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Philibert Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1907</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1997</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emile Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emma de Milliano<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Frans van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1761</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1833</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jacobus Bernardus van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pauwels van Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1535</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1582</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>N. van Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Clara Aernoudts<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1918</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">2012</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Henry Aernoudts<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Sidonie Coene<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emile Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1877</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1968</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carolus Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria Sturm<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1696</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1724</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carel de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna Claes<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1602</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1642</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven van Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1692</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1743</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Daniel Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna de Pape<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Bernard Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1695</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1762</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Willem Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella Wauters<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven van Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1570</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1636</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pauwels van Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lievijne Jans<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1762</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1807</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Bernardus de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Willem Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1668</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1731</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Hercke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Antone Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1753</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1798</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Francies Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella de Decker<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1801</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1834</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Frans van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna de Causmaecker<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Angela Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1728</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1734</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Bernard Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina de Vrieze<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1711</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1754</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria de Rycke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lievijne Jans<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1542</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1582</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-c1">null</span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Bernardus de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1721</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1789</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven de Causmaecker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina Haverbeke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jacoba Lammens<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1699</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1740</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven Lammens<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina de Vrieze<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter de Decker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1705</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1780</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joos de Decker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella van de Steene<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Joanna de Pape<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1654</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1723</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Vincent de Pape<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella Wauters<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Daniel Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1652</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1723</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Hercke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1631</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1676</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Anna van Hecke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Martina de Pape<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1666</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1727</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Vincent de Pape<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella Wauters<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Francies Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1725</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1779</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Bernard Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina de Vrieze<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1905</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1997</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emile Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Emma de Milliano<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Petronella de Decker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1731</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1781</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter de Decker<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina Haverbeke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina Sierens<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1761</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1826</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Sierens<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria van Waes<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Laurentia Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1710</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1786</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria de Rycke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Carel Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1796</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1837</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Pieter Antone Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Livina Sierens<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Hercke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1632</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1674</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Willem Hercke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Margriet de Brabander<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1671</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1731</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lieven Haverbeke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Hercke<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Anna van Hecke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1607</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1670</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Paschasius van Hecke<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Martijntken Beelaert<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Maria Sturm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>f<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1835</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1917</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Charles Sturm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Seraphina Spelier<span class="pl-pds">"</span></span>},
  {<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jacobus Bernardus van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>sex<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>born<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1736</span>, <span class="pl-s"><span class="pl-pds">"</span>died<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1809</span>, <span class="pl-s"><span class="pl-pds">"</span>father<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Jan van Brussel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>mother<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Elisabeth Haverbeke<span class="pl-pds">"</span></span>}
])

<span class="pl-k">var</span> ancestry <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(<span class="pl-c1">ANCESTRY_FILE</span>);

<span class="pl-k">function</span> <span class="pl-en">average</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">function</span> <span class="pl-en">plus</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) { <span class="pl-k">return</span> a <span class="pl-k">+</span> b; }
  <span class="pl-k">return</span> <span class="pl-smi">array</span>.<span class="pl-en">reduce</span>(plus) <span class="pl-k">/</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>;
}

<span class="pl-k">var</span> byName <span class="pl-k">=</span> {};
<span class="pl-smi">ancestry</span>.<span class="pl-c1">forEach</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
  byName[<span class="pl-smi">person</span>.<span class="pl-c1">name</span>] <span class="pl-k">=</span> person;
});

<span class="pl-k">function</span> <span class="pl-en">hasKnownMother</span>(<span class="pl-smi">person</span>){
  <span class="pl-k">return</span> byName[<span class="pl-smi">person</span>.<span class="pl-smi">mother</span>] <span class="pl-k">!=</span> <span class="pl-c1">null</span>;
}

<span class="pl-k">function</span> <span class="pl-en">calcAgeDiffMotherChild</span>(<span class="pl-smi">person</span>){
  <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-smi">born</span> <span class="pl-k">-</span> byName[<span class="pl-smi">person</span>.<span class="pl-smi">mother</span>].<span class="pl-smi">born</span>;
}

<span class="pl-k">var</span> differences <span class="pl-k">=</span> ancestry
  .<span class="pl-en">filter</span>(hasKnownMother)
  .<span class="pl-en">map</span>(calcAgeDiffMotherChild);

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">average</span>(differences));
<span class="pl-c"><span class="pl-c">//</span> → 31.2</span></pre></div>
<h3 id="343-historical-life-expectancy">3.4.3. Historical Life Expectancy</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> ancestry <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(<span class="pl-c1">ANCESTRY_FILE</span>);

<span class="pl-k">function</span> <span class="pl-en">average</span>(<span class="pl-smi">array</span>) {
  <span class="pl-k">function</span> <span class="pl-en">plus</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) { <span class="pl-k">return</span> a <span class="pl-k">+</span> b; }
  <span class="pl-k">return</span> <span class="pl-smi">array</span>.<span class="pl-en">reduce</span>(plus) <span class="pl-k">/</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>;
}

<span class="pl-k">function</span> <span class="pl-en">groupBy</span>(<span class="pl-smi">array</span>, <span class="pl-smi">fun</span>) {
  <span class="pl-k">var</span> groups <span class="pl-k">=</span> {};
  <span class="pl-smi">array</span>.<span class="pl-c1">forEach</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>) {
    <span class="pl-k">var</span> group <span class="pl-k">=</span> <span class="pl-en">fun</span>(person);
    <span class="pl-k">if</span> (group <span class="pl-k">in</span> groups)
      <span class="pl-c"><span class="pl-c">//</span> if group already exists</span>
      groups[group].<span class="pl-c1">push</span>(person);
    <span class="pl-k">else</span>
      <span class="pl-c"><span class="pl-c">//</span> create a new group</span>
      groups[group] <span class="pl-k">=</span> [person];
  })
  <span class="pl-k">return</span> groups;
}

<span class="pl-c"><span class="pl-c">//</span> create a new group object by centuries</span>
<span class="pl-k">var</span> groupByCenturies <span class="pl-k">=</span> <span class="pl-en">groupBy</span>(ancestry, <span class="pl-k">function</span>(<span class="pl-smi">person</span>){
  <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">ceil</span>(<span class="pl-smi">person</span>.<span class="pl-smi">died</span><span class="pl-k">/</span> <span class="pl-c1">100</span>);
});

<span class="pl-k">for</span> (<span class="pl-k">var</span> group <span class="pl-k">in</span> groupByCenturies){
  <span class="pl-k">var</span> ages <span class="pl-k">=</span> groupByCenturies[group].<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">person</span>){
    <span class="pl-k">return</span> <span class="pl-smi">person</span>.<span class="pl-smi">died</span> <span class="pl-k">-</span> <span class="pl-smi">person</span>.<span class="pl-smi">born</span>;
  });
  <span class="pl-k">var</span> avg <span class="pl-k">=</span> <span class="pl-en">average</span>(ages);
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(group <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> avg);
}

<span class="pl-c"><span class="pl-c">//</span> → 16: 43.5</span>
<span class="pl-c"><span class="pl-c">//</span>   17: 51.2</span>
<span class="pl-c"><span class="pl-c">//</span>   18: 52.8</span>
<span class="pl-c"><span class="pl-c">//</span>   19: 54.8</span>
<span class="pl-c"><span class="pl-c">//</span>   20: 84.7</span>
<span class="pl-c"><span class="pl-c">//</span>   21: 94</span></pre></div>
<h3 id="344-every-and-some">3.4.4. <code>every</code> and <code>some</code></h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">every</span>(<span class="pl-smi">array</span>, <span class="pl-smi">test</span>){
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>){
    <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-en">test</span>(array[i]))
      <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  }
  <span class="pl-k">return</span> <span class="pl-c1">true</span>;
}

<span class="pl-k">function</span> <span class="pl-en">some</span>(<span class="pl-smi">array</span>, <span class="pl-smi">test</span>){
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>){
    <span class="pl-k">if</span> (<span class="pl-en">test</span>(array[i]))
      <span class="pl-k">return</span> <span class="pl-c1">true</span>;
  }
  <span class="pl-k">return</span> <span class="pl-c1">false</span>;
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">every</span>([<span class="pl-c1">NaN</span>, <span class="pl-c1">NaN</span>, <span class="pl-c1">NaN</span>], isNaN));
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">every</span>([<span class="pl-c1">NaN</span>, <span class="pl-c1">NaN</span>, <span class="pl-c1">4</span>], isNaN));
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">some</span>([<span class="pl-c1">NaN</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>], isNaN));
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">some</span>([<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>], isNaN));
<span class="pl-c"><span class="pl-c">//</span> → false</span></pre></div>
<h1 id="4-chapter-6-the-secret-life-of-objects">4. Chapter 6: The Secret Life of Objects</h1>
<h2 id="41-encapsulation">4.1. Encapsulation</h2>
<p>One useful thing to do with objects is to specify an <strong>interface</strong> for them and tell everybody that they are supposed to talk to your object only through that interface. The rest of the details that make up your object are now <em>encapsulated</em>, hidden behind the interface (internal complexity VS external interface).</p>
<h2 id="42-this">4.2. <code>this</code></h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">speak</span>(<span class="pl-smi">line</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>The <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">this</span>.<span class="pl-c1">type</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> rabbit says '<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
              line <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>'<span class="pl-pds">"</span></span>);
}
<span class="pl-k">var</span> whiteRabbit <span class="pl-k">=</span> {type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>white<span class="pl-pds">"</span></span>, speak<span class="pl-k">:</span> speak};
<span class="pl-k">var</span> fatRabbit <span class="pl-k">=</span> {type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>fat<span class="pl-pds">"</span></span>, speak<span class="pl-k">:</span> speak};

<span class="pl-smi">whiteRabbit</span>.<span class="pl-en">speak</span>(<span class="pl-s"><span class="pl-pds">"</span>Oh my ears and whiskers, <span class="pl-pds">"</span></span> <span class="pl-k">+</span>
                  <span class="pl-s"><span class="pl-pds">"</span>how late it's getting!<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → The white rabbit says 'Oh my ears and whiskers, how</span>
<span class="pl-c"><span class="pl-c">//</span>   late it's getting!'</span>
<span class="pl-smi">fatRabbit</span>.<span class="pl-en">speak</span>(<span class="pl-s"><span class="pl-pds">"</span>I could sure use a carrot right now.<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → The fat rabbit says 'I could sure use a carrot</span>
<span class="pl-c"><span class="pl-c">//</span>   right now.'</span></pre></div>
<p>The code uses the <code>this</code> keyword to output the type of rabbit that is speaking. Recall that the <code>apply</code> and <code>bind</code> methods both take a first argument that can be used to simulate method calls. This first argument is in fact used to give a value to <code>this</code>.</p>
<p>There is a method similar to <code>apply</code>, called <code>call</code>. It also calls the function it is a method of but takes its arguments normally, rather than as an array. Like <code>apply</code> and <code>bind</code>, <code>call</code> can be passed a specific <code>this</code> value.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">speak</span>.<span class="pl-c1">apply</span>(fatRabbit, [<span class="pl-s"><span class="pl-pds">"</span>Burp!<span class="pl-pds">"</span></span>]);
<span class="pl-c"><span class="pl-c">//</span> → The fat rabbit says 'Burp!'</span>
<span class="pl-smi">speak</span>.<span class="pl-c1">call</span>({type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>old<span class="pl-pds">"</span></span>}, <span class="pl-s"><span class="pl-pds">"</span>Oh my.<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → The old rabbit says 'Oh my.'</span></pre></div>
<h2 id="43-prototype">4.3. Prototype</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> empty <span class="pl-k">=</span> {};
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">empty</span>.<span class="pl-smi">toString</span>);
<span class="pl-c"><span class="pl-c">//</span> → function toString(){…}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">empty</span>.<span class="pl-c1">toString</span>());
<span class="pl-c"><span class="pl-c">//</span> → [object Object]</span></pre></div>
<p>In addition to their set of properties, almost all objects also have a <em>prototype</em>. A prototype is another object that is used as a fallback source of properties. When an object gets a request for a property that it does not have, its prototype will be searched for the property, then the prototype’s prototype, and so on.</p>
<p>So who is the prototype of that empty object? It is the great ancestral prototype, the entity behind almost all objects, <code>Object.prototype</code>.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">Object</span>.<span class="pl-en">getPrototypeOf</span>({}) <span class="pl-k">==</span>
            <span class="pl-c1">Object</span>.<span class="pl-c1">prototype</span>);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">Object</span>.<span class="pl-en">getPrototypeOf</span>(<span class="pl-c1">Object</span>.<span class="pl-c1">prototype</span>));
<span class="pl-c"><span class="pl-c">//</span> → null</span></pre></div>
<p>Many objects don’t directly have <code>Object.prototype</code> as their prototype, but instead have another object, which provides its own default properties. <strong>Functions</strong> derive from <code>Function.prototype</code>, and <strong>arrays</strong> derive from <code>Array.prototype</code>.</p>
<p>Functions related:</p>
<ul>
<li><code>Object.getPrototypeOf</code> (returns the prototype of an object)</li>
<li><code>Object.create</code> (create an object with a specific prototype)</li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">Object</span>.<span class="pl-en">getPrototypeOf</span>(isNaN) <span class="pl-k">==</span>
            <span class="pl-c1">Function</span>.<span class="pl-c1">prototype</span>);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">Object</span>.<span class="pl-en">getPrototypeOf</span>([]) <span class="pl-k">==</span>
            <span class="pl-c1">Array</span>.<span class="pl-c1">prototype</span>);
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> protoRabbit <span class="pl-k">=</span> {
  <span class="pl-en">speak</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">line</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>The <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">this</span>.<span class="pl-c1">type</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> rabbit says '<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
                line <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>'<span class="pl-pds">"</span></span>);
  }
};
<span class="pl-k">var</span> killerRabbit <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">create</span>(protoRabbit);
<span class="pl-smi">killerRabbit</span>.<span class="pl-c1">type</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>killer<span class="pl-pds">"</span></span>;
<span class="pl-smi">killerRabbit</span>.<span class="pl-en">speak</span>(<span class="pl-s"><span class="pl-pds">"</span>SKREEEE!<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → The killer rabbit says 'SKREEEE!'</span></pre></div>
<h2 id="44-constructors">4.4. Constructors</h2>
<p>A more convenient way to create objects that derive from some shared prototype is to use a <strong>constructor</strong>. In JavaScript, calling a function with the <code>new</code> keyword in front of it causes it to be treated as a constructor. The constructor will have its <code>this</code> variable bound to a fresh object, and unless it explicitly returns another object value, this new object will be returned from the call.</p>
<p>An object created with <code>new</code> is said to be an <strong>instance</strong> of its constructor.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c"><span class="pl-c">//</span> It is a convention to capitalize the names of constructors</span>
<span class="pl-k">function</span> <span class="pl-en">Rabbit</span>(<span class="pl-smi">type</span>) {
  <span class="pl-c1">this</span>.<span class="pl-c1">type</span> <span class="pl-k">=</span> type;
}

<span class="pl-k">var</span> killerRabbit <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Rabbit</span>(<span class="pl-s"><span class="pl-pds">"</span>killer<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> blackRabbit <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Rabbit</span>(<span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">blackRabbit</span>.<span class="pl-c1">type</span>);
<span class="pl-c"><span class="pl-c">//</span> → black</span></pre></div>
<p>Constructors (in fact, all functions) automatically get a property named prototype, which by default holds a plain, empty object that derives from <code>Object.prototype</code>. Every instance created with this constructor will have this object as its prototype. So to add a <code>speak</code> method to rabbits created with the Rabbit constructor, we can simply do this:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">Rabbit</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">speak</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">line</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>The <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">this</span>.<span class="pl-c1">type</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> rabbit says '<span class="pl-pds">"</span></span> <span class="pl-k">+</span>
              line <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>'<span class="pl-pds">"</span></span>);
};
<span class="pl-smi">blackRabbit</span>.<span class="pl-en">speak</span>(<span class="pl-s"><span class="pl-pds">"</span>Doom...<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span> → The black rabbit says 'Doom...'</span></pre></div>
<p>It is important to note the distinction between the way a prototype is associated with a constructor (through its <code>prototype</code> property) and the way objects have a prototype (which can be retrieved with <code>Object.getPrototypeOf</code>). The actual prototype of a constructor is <code>Function.prototype</code> since constructors are functions. Its <code>prototype</code> property will be the prototype of instances created through it but is not its <em>own</em> prototype.</p>
<h2 id="45-overriding-derived-properties">4.5. Overriding derived properties</h2>
<p>When you add a property to an object, whether it is present in the prototype or not, the property is added to the object itself, which will henceforth have it as its own property. If there is a property by the same name in the prototype, this property will no longer affect the object. The prototype itself is not changed.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">Rabbit</span>.<span class="pl-c1">prototype</span>.<span class="pl-smi">teeth</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>small<span class="pl-pds">"</span></span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">killerRabbit</span>.<span class="pl-smi">teeth</span>);
<span class="pl-c"><span class="pl-c">//</span> → small</span>
<span class="pl-smi">killerRabbit</span>.<span class="pl-smi">teeth</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>long, sharp, and bloody<span class="pl-pds">"</span></span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">killerRabbit</span>.<span class="pl-smi">teeth</span>);
<span class="pl-c"><span class="pl-c">//</span> → long, sharp, and bloody</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">blackRabbit</span>.<span class="pl-smi">teeth</span>);
<span class="pl-c"><span class="pl-c">//</span> → small</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">Rabbit</span>.<span class="pl-c1">prototype</span>.<span class="pl-smi">teeth</span>);
<span class="pl-c"><span class="pl-c">//</span> → small</span></pre></div>
<p>Overriding properties that exist in a prototype is often a useful thing to do. As the rabbit teeth example shows, it can be used to express exceptional properties in instances of a more generic class of objects, while letting the nonexceptional objects simply take a standard value from their prototype.</p>
<h2 id="46-prototype-interference">4.6. Prototype interference</h2>
<p>A prototype can be used at any time to add new properties and methods to all objects based on it. For example, it might become necessary for our rabbits to dance.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">Rabbit</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">dance</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>The <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">this</span>.<span class="pl-c1">type</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> rabbit dances a jig.<span class="pl-pds">"</span></span>);
};
<span class="pl-smi">killerRabbit</span>.<span class="pl-en">dance</span>();
<span class="pl-c"><span class="pl-c">//</span> → The killer rabbit dances a jig.</span></pre></div>
<p>That’s convenient. But there are situations where it causes problems. In previous chapters, we used an object as a way to associate values with names by creating properties for the names and giving them the corresponding value as their value.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> map <span class="pl-k">=</span> {};
<span class="pl-k">function</span> <span class="pl-en">storePhi</span>(<span class="pl-c1">event</span>, <span class="pl-smi">phi</span>) {
  map[<span class="pl-c1">event</span>] <span class="pl-k">=</span> phi;
}

<span class="pl-en">storePhi</span>(<span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span>, <span class="pl-c1">0.069</span>);
<span class="pl-en">storePhi</span>(<span class="pl-s"><span class="pl-pds">"</span>touched tree<span class="pl-pds">"</span></span>, <span class="pl-k">-</span><span class="pl-c1">0.081</span>);

<span class="pl-c1">Object</span>.<span class="pl-c1">prototype</span>.<span class="pl-smi">nonsense</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hi<span class="pl-pds">"</span></span>;
<span class="pl-k">for</span> (<span class="pl-k">var</span> name <span class="pl-k">in</span> map)
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(name);
<span class="pl-c"><span class="pl-c">//</span> → pizza</span>
<span class="pl-c"><span class="pl-c">//</span> → touched tree</span>
<span class="pl-c"><span class="pl-c">//</span> → nonsense</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>nonsense<span class="pl-pds">"</span></span> <span class="pl-k">in</span> map);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>toString<span class="pl-pds">"</span></span> <span class="pl-k">in</span> map);
<span class="pl-c"><span class="pl-c">//</span> → true</span>

<span class="pl-c"><span class="pl-c">//</span> Delete the problematic property again</span>
<span class="pl-k">delete</span> <span class="pl-c1">Object</span>.<span class="pl-c1">prototype</span>.<span class="pl-smi">nonsense</span>;</pre></div>
<p>That’s all wrong. There is no event called “nonsense” in our data set. And there definitely is no event called “toString”.</p>
<p>Oddly, <code>toString</code> did not show up in the <code>for/in</code> loop, but the in operator did return true for it. This is because JavaScript distinguishes between <strong>enumerable</strong> and <strong>nonenumerable</strong> properties.</p>
<p>All properties that we create by simply assigning to them are <em>enumerable</em>. The standard properties in <code>Object.prototype</code> are all <em>nonenumerable</em>, which is why they do not show up in such a <code>for/in</code> loop.</p>
<p>It is possible to define our own nonenumerable properties by using the <code>Object.defineProperty</code> function, which allows us to control the type of property we are creating.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">Object</span>.<span class="pl-en">defineProperty</span>(<span class="pl-c1">Object</span>.<span class="pl-c1">prototype</span>, <span class="pl-s"><span class="pl-pds">"</span>hiddenNonsense<span class="pl-pds">"</span></span>,
                      {enumerable<span class="pl-k">:</span> <span class="pl-c1">false</span>, value<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>hi<span class="pl-pds">"</span></span>});
<span class="pl-k">for</span> (<span class="pl-k">var</span> name <span class="pl-k">in</span> map)
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(name);
<span class="pl-c"><span class="pl-c">//</span> → pizza</span>
<span class="pl-c"><span class="pl-c">//</span> → touched tree</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">map</span>.<span class="pl-smi">hiddenNonsense</span>);
<span class="pl-c"><span class="pl-c">//</span> → hi</span></pre></div>
<p>So now the property is there, but it won’t show up in a loop. That’s good. But we still have the problem with the regular <code>in</code> operator claiming that the <code>Object.prototype</code> properties exist in our object. For that, we can use the object’s <code>hasOwnProperty</code> method.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">map</span>.<span class="pl-en">hasOwnProperty</span>(<span class="pl-s"><span class="pl-pds">"</span>toString<span class="pl-pds">"</span></span>));
<span class="pl-c"><span class="pl-c">//</span> → false</span></pre></div>
<p>This method tells us whether the object <em>itself</em> has the property, without looking at its prototypes.</p>
<p>When you are worried that someone (some other code you loaded into your program) might have messed with the base object prototype, I recommend you write your <code>for/in</code> loops like this:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">for</span> (<span class="pl-k">var</span> name <span class="pl-k">in</span> map) {
  <span class="pl-k">if</span> (<span class="pl-smi">map</span>.<span class="pl-en">hasOwnProperty</span>(name)) {
    <span class="pl-c"><span class="pl-c">//</span> ... this is an own property</span>
  }
}</pre></div>
<h2 id="47-prototype-less-objects">4.7. Prototype-less Objects</h2>
<p>What if someone registered the name <code>hasOwnProperty</code> in our <code>map</code> object and set it to the value 42? Now the call to <code>map.hasOwnProperty</code> will try to call the local property, which holds a number, not a function.</p>
<p>In such a case, prototypes just get in the way, and we would actually prefer to have objects without prototypes. We saw the <code>Object.create</code> function, which allows us to create an object with a specific prototype. You are allowed to pass null as the prototype to create a fresh object with no prototype. For objects like map, where the properties could be anything, this is exactly what we want.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> map <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">create</span>(<span class="pl-c1">null</span>);
map[<span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">0.069</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>toString<span class="pl-pds">"</span></span> <span class="pl-k">in</span> map);
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>pizza<span class="pl-pds">"</span></span> <span class="pl-k">in</span> map);
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<p>We no longer need the <code>hasOwnProperty</code> kludge because all the properties the object has are its own properties.</p>
<h2 id="48-polymorphism">4.8. Polymorphism</h2>
<p>When you call the <code>String</code> function, which converts a value to a string, on an object, it will call the <code>toString</code> method on that object to try to create a meaningful string to return. I mentioned that some of the standard prototypes define their own version of <code>toString</code> so they can create a string that contains more useful information than "<code>[object Object]</code>".</p>
<p>This is a simple instance of a powerful idea. When a piece of code is written to work with objects that have a certain interface—in this case, a <code>toString</code> method—any kind of object that happens to support this interface can be plugged into the code, and it will just work.</p>
<p>This technique is called <em>polymorphism</em>—though no actual shape-shifting is involved. Polymorphic code can work with values of different shapes, as long as they support the interface it expects.</p>
<h2 id="49-getters-and-setters">4.9. Getters and Setters</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> pile <span class="pl-k">=</span> {
  elements<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>eggshell<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>orange peel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>worm<span class="pl-pds">"</span></span>],
  <span class="pl-k">get</span> <span class="pl-en">height</span>() {
    <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">elements</span>.<span class="pl-c1">length</span>;
  },
  <span class="pl-k">set</span> <span class="pl-en">height</span>(<span class="pl-smi">value</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Ignoring attempt to set height to<span class="pl-pds">"</span></span>, value);
  }
};

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">pile</span>.<span class="pl-c1">height</span>);
<span class="pl-c"><span class="pl-c">//</span> → 3</span>
<span class="pl-smi">pile</span>.<span class="pl-c1">height</span> <span class="pl-k">=</span> <span class="pl-c1">100</span>;
<span class="pl-c"><span class="pl-c">//</span> → Ignoring attempt to set height to 100</span></pre></div>
<p>In an object literal, the <code>get</code> or <code>set</code> notation for properties allows you to specify a function to be run when the property is read or written. You can also add such a property to an existing object, for example a prototype, using the <code>Object.defineProperty</code> function.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">Object</span>.<span class="pl-en">defineProperty</span>(<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>, <span class="pl-s"><span class="pl-pds">"</span>heightProp<span class="pl-pds">"</span></span>, {
  <span class="pl-en">get</span><span class="pl-k">:</span> <span class="pl-k">function</span>() { <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-c1">length</span>; }
});

<span class="pl-k">var</span> cell <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-cce">\n</span>way<span class="pl-pds">"</span></span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span>);
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span> <span class="pl-k">=</span> <span class="pl-c1">100</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span>);
<span class="pl-c"><span class="pl-c">//</span> → 2</span></pre></div>
<p>You can use a similar <code>set</code> property, in the object passed to <code>defineProperty</code>, to specify a setter method. When a getter but no setter is defined, writing to the property is simply ignored.</p>
<h2 id="410-inheritance">4.10. Inheritance</h2>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">repeat</span>(<span class="pl-smi">string</span>, <span class="pl-smi">times</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> times; i<span class="pl-k">++</span>)
    result <span class="pl-k">+=</span> string;
  <span class="pl-k">return</span> result;
}

<span class="pl-c"><span class="pl-c">//</span> Parent (Old Constructor)</span>
<span class="pl-k">function</span> <span class="pl-en">TextCell</span>(<span class="pl-smi">text</span>) {
  <span class="pl-c1">this</span>.<span class="pl-c1">text</span> <span class="pl-k">=</span> <span class="pl-smi">text</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
}
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minWidth</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">line</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(width, <span class="pl-smi">line</span>.<span class="pl-c1">length</span>);
  }, <span class="pl-c1">0</span>);
};
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minHeight</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-c1">length</span>;
};
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> height; i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>[i] <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-smi">result</span>.<span class="pl-c1">push</span>(line <span class="pl-k">+</span> <span class="pl-en">repeat</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>, width <span class="pl-k">-</span> <span class="pl-smi">line</span>.<span class="pl-c1">length</span>));
  }
  <span class="pl-k">return</span> result;
};


<span class="pl-c"><span class="pl-c">//</span> Child (New Constructor)</span>
<span class="pl-k">function</span> <span class="pl-en">RTextCell</span>(<span class="pl-smi">text</span>) {
  <span class="pl-smi">TextCell</span>.<span class="pl-c1">call</span>(<span class="pl-c1">this</span>, text);
}
<span class="pl-smi">RTextCell</span>.<span class="pl-c1">prototype</span> <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">create</span>(<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>);
<span class="pl-smi">RTextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> height; i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>[i] <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-smi">result</span>.<span class="pl-c1">push</span>(<span class="pl-en">repeat</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>, width <span class="pl-k">-</span> <span class="pl-smi">line</span>.<span class="pl-c1">length</span>) <span class="pl-k">+</span> line);
  }
  <span class="pl-k">return</span> result;
};</pre></div>
<h2 id="411-the-instanceof-operator">4.11. The <code>instanceof</code> Operator</h2>
<p>It is occasionally useful to know whether an object was derived from a specific constructor. For this, JavaScript provides a binary operator called <code>instanceof</code>. The operator will see through inherited types.</p>
<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">RTextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>) <span class="pl-k">instanceof</span> RTextCell);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">RTextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>) <span class="pl-k">instanceof</span> TextCell);
<span class="pl-c"><span class="pl-c">//</span> → true</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>A<span class="pl-pds">"</span></span>) <span class="pl-k">instanceof</span> RTextCell);
<span class="pl-c"><span class="pl-c">//</span> → false</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>([<span class="pl-c1">1</span>] <span class="pl-k">instanceof</span> <span class="pl-c1">Array</span>);
<span class="pl-c"><span class="pl-c">//</span> → true</span></pre></div>
<h2 id="412-examples">4.12. Examples</h2>
<h3 id="4121-laying-out-a-table">4.12.1. Laying out a Table</h3>
<p>The project is this: we will write a program that, given an array of arrays of table cells, builds up a string that contains a nicely laid out table:</p>
<pre><code>name         height country
------------ ------ -------------
Kilimanjaro    5895 Tanzania
Everest        8848 Nepal
Mount Fuji     3776 Japan
Mont Blanc     4808 Italy/France
Vaalserberg     323 Netherlands
Denali         6168 United States
Popocatepetl   5465 Mexico
</code></pre>
<p>This is the interface:</p>
<ul>
<li><code>minHeight()</code> returns a number indicating the minimum height this cell requires (in lines).</li>
<li><code>minWidth()</code> returns a number indicating this cell’s minimum width (in characters).</li>
<li><code>draw(width, height)</code> returns an array of length <code>height</code>, which contains a series of strings that are each <code>width</code> characters wide. This represents the content of the cell.</li>
</ul>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">rowHeights</span>(<span class="pl-smi">rows</span>) {
  <span class="pl-k">return</span> <span class="pl-smi">rows</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">row</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">row</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">max</span>, <span class="pl-smi">cell</span>) {
      <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(max, <span class="pl-smi">cell</span>.<span class="pl-en">minHeight</span>());
    }, <span class="pl-c1">0</span>);
  });
}

<span class="pl-c"><span class="pl-c">//</span> second argument to the function for 'map' (as well as forEach, filter, and similar array methods)</span>
<span class="pl-c"><span class="pl-c">//</span> is the index of the current element</span>
<span class="pl-k">function</span> <span class="pl-en">colWidths</span>(<span class="pl-smi">rows</span>) {
  <span class="pl-k">return</span> rows[<span class="pl-c1">0</span>].<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">_</span>, <span class="pl-smi">i</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">rows</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">max</span>, <span class="pl-smi">row</span>) {
      <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(max, row[i].<span class="pl-en">minWidth</span>());
    }, <span class="pl-c1">0</span>);
  });
}

<span class="pl-c"><span class="pl-c">//</span> DRAWING THE TABLE</span>
<span class="pl-k">function</span> <span class="pl-en">drawTable</span>(<span class="pl-smi">rows</span>) {
  <span class="pl-k">var</span> heights <span class="pl-k">=</span> <span class="pl-en">rowHeights</span>(rows);
  <span class="pl-k">var</span> widths <span class="pl-k">=</span> <span class="pl-en">colWidths</span>(rows);

  <span class="pl-k">function</span> <span class="pl-en">drawLine</span>(<span class="pl-smi">blocks</span>, <span class="pl-smi">lineNo</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">blocks</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">block</span>) {
      <span class="pl-k">return</span> block[lineNo];
    }).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>);
  }

  <span class="pl-k">function</span> <span class="pl-en">drawRow</span>(<span class="pl-smi">row</span>, <span class="pl-smi">rowNum</span>) {
    <span class="pl-k">var</span> blocks <span class="pl-k">=</span> <span class="pl-smi">row</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">cell</span>, <span class="pl-smi">colNum</span>) {
      <span class="pl-k">return</span> <span class="pl-smi">cell</span>.<span class="pl-en">draw</span>(widths[colNum], heights[rowNum]);
    });
    <span class="pl-k">return</span> blocks[<span class="pl-c1">0</span>].<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">_</span>, <span class="pl-smi">lineNo</span>) {
      <span class="pl-k">return</span> <span class="pl-en">drawLine</span>(blocks, lineNo);
    }).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
  }

  <span class="pl-k">return</span> <span class="pl-smi">rows</span>.<span class="pl-en">map</span>(drawRow).<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
}

<span class="pl-c"><span class="pl-c">//</span> CONSTRUCTOR FOR CELLS THAT CONTAIN TEXT</span>
<span class="pl-k">function</span> <span class="pl-en">repeat</span>(<span class="pl-smi">string</span>, <span class="pl-smi">times</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> times; i<span class="pl-k">++</span>)
    result <span class="pl-k">+=</span> string;
  <span class="pl-k">return</span> result;
}

<span class="pl-k">function</span> <span class="pl-en">TextCell</span>(<span class="pl-smi">text</span>) {
  <span class="pl-c1">this</span>.<span class="pl-c1">text</span> <span class="pl-k">=</span> <span class="pl-smi">text</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
}
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minWidth</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-en">reduce</span>(<span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">line</span>) {
    <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(width, <span class="pl-smi">line</span>.<span class="pl-c1">length</span>);
  }, <span class="pl-c1">0</span>);
};
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minHeight</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-c1">length</span>;
};
<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> height; i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>[i] <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-smi">result</span>.<span class="pl-c1">push</span>(line <span class="pl-k">+</span> <span class="pl-en">repeat</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>, width <span class="pl-k">-</span> <span class="pl-smi">line</span>.<span class="pl-c1">length</span>));
  }
  <span class="pl-k">return</span> result;
};

<span class="pl-c"><span class="pl-c">//</span> Testing TextCell Constructor</span>
<span class="pl-k">var</span> rows <span class="pl-k">=</span> [];
<span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">5</span>; i<span class="pl-k">++</span>) {
   <span class="pl-k">var</span> row <span class="pl-k">=</span> [];
   <span class="pl-k">for</span> (<span class="pl-k">var</span> j <span class="pl-k">=</span> <span class="pl-c1">0</span>; j <span class="pl-k">&lt;</span> <span class="pl-c1">5</span>; j<span class="pl-k">++</span>) {
     <span class="pl-k">if</span> ((j <span class="pl-k">+</span> i) <span class="pl-k">%</span> <span class="pl-c1">2</span> <span class="pl-k">==</span> <span class="pl-c1">0</span>)
       <span class="pl-smi">row</span>.<span class="pl-c1">push</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>##<span class="pl-pds">"</span></span>));
     <span class="pl-k">else</span>
       <span class="pl-smi">row</span>.<span class="pl-c1">push</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>  <span class="pl-pds">"</span></span>));
   }
   <span class="pl-smi">rows</span>.<span class="pl-c1">push</span>(row);
}
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">drawTable</span>(rows));
<span class="pl-c"><span class="pl-c">//</span> → ##    ##    ##</span>
<span class="pl-c"><span class="pl-c">//</span>      ##    ##</span>
<span class="pl-c"><span class="pl-c">//</span>   ##    ##    ##</span>
<span class="pl-c"><span class="pl-c">//</span>      ##    ##</span>
<span class="pl-c"><span class="pl-c">//</span>   ##    ##    ##</span>

<span class="pl-c"><span class="pl-c">//</span> UNDERLYING CELLS</span>
<span class="pl-k">function</span> <span class="pl-en">UnderlinedCell</span>(<span class="pl-smi">inner</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">inner</span> <span class="pl-k">=</span> inner;
}
<span class="pl-smi">UnderlinedCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minWidth</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">minWidth</span>();
};
<span class="pl-smi">UnderlinedCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minHeight</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">minHeight</span>() <span class="pl-k">+</span> <span class="pl-c1">1</span>;
};
<span class="pl-smi">UnderlinedCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">draw</span>(width, height <span class="pl-k">-</span> <span class="pl-c1">1</span>)
    .<span class="pl-c1">concat</span>([<span class="pl-en">repeat</span>(<span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span>, width)]);
};

<span class="pl-c"><span class="pl-c">//</span> Testing underlying cells</span>
<span class="pl-k">function</span> <span class="pl-en">dataTable</span>(<span class="pl-smi">data</span>) {
  <span class="pl-k">var</span> keys <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(data[<span class="pl-c1">0</span>]);
  <span class="pl-k">var</span> headers <span class="pl-k">=</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">UnderlinedCell</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(name));
  });
  <span class="pl-k">var</span> body <span class="pl-k">=</span> <span class="pl-smi">data</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">row</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-c1">String</span>(row[name]));
    });
  });
  <span class="pl-k">return</span> [headers].<span class="pl-c1">concat</span>(body);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">drawTable</span>(<span class="pl-en">dataTable</span>(<span class="pl-c1">MOUNTAINS</span>)));
<span class="pl-c"><span class="pl-c">//</span> → name         height country</span>
<span class="pl-c"><span class="pl-c">//</span>   ------------ ------ -------------</span>
<span class="pl-c"><span class="pl-c">//</span>   Kilimanjaro  5895   Tanzania</span>
<span class="pl-c"><span class="pl-c">//</span>   … etcetera</span>

<span class="pl-c"><span class="pl-c">//</span> DRAWING A TABLE</span>
<span class="pl-k">function</span> <span class="pl-en">dataTable</span>(<span class="pl-smi">data</span>) {
  <span class="pl-k">var</span> keys <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(data[<span class="pl-c1">0</span>]);
  <span class="pl-k">var</span> headers <span class="pl-k">=</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">UnderlinedCell</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(name));
  });
  <span class="pl-k">var</span> body <span class="pl-k">=</span> <span class="pl-smi">data</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">row</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
      <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-c1">String</span>(row[name]));
    });
  });
  <span class="pl-k">return</span> [headers].<span class="pl-c1">concat</span>(body);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">drawTable</span>(<span class="pl-en">dataTable</span>(<span class="pl-c1">MOUNTAINS</span>)));
<span class="pl-c"><span class="pl-c">//</span> → name         height country</span>
<span class="pl-c"><span class="pl-c">//</span>   ------------ ------ -------------</span>
<span class="pl-c"><span class="pl-c">//</span>   Kilimanjaro  5895   Tanzania</span>
<span class="pl-c"><span class="pl-c">//</span>   … etcetera</span>

<span class="pl-c"><span class="pl-c">//</span> DEFINE GETTERS to exisiting objects</span>
<span class="pl-c1">Object</span>.<span class="pl-en">defineProperty</span>(<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>, <span class="pl-s"><span class="pl-pds">"</span>heightProp<span class="pl-pds">"</span></span>, {
  <span class="pl-en">get</span><span class="pl-k">:</span> <span class="pl-k">function</span>() { <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>.<span class="pl-c1">length</span>; }
});

<span class="pl-k">var</span> cell <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>no<span class="pl-cce">\n</span>way<span class="pl-pds">"</span></span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span>);
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span> <span class="pl-k">=</span> <span class="pl-c1">100</span>;
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">cell</span>.<span class="pl-smi">heightProp</span>);
<span class="pl-c"><span class="pl-c">//</span> → 2</span>

<span class="pl-c"><span class="pl-c">//</span> Construct Right-Aligned TextCells using INHERITANCE</span>
<span class="pl-k">function</span> <span class="pl-en">RTextCell</span>(<span class="pl-smi">text</span>) {
  <span class="pl-smi">TextCell</span>.<span class="pl-c1">call</span>(<span class="pl-c1">this</span>, text);
}
<span class="pl-smi">RTextCell</span>.<span class="pl-c1">prototype</span> <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-en">create</span>(<span class="pl-smi">TextCell</span>.<span class="pl-c1">prototype</span>);
<span class="pl-smi">RTextCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">var</span> result <span class="pl-k">=</span> [];
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> height; i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> line <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">text</span>[i] <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-smi">result</span>.<span class="pl-c1">push</span>(<span class="pl-en">repeat</span>(<span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>, width <span class="pl-k">-</span> <span class="pl-smi">line</span>.<span class="pl-c1">length</span>) <span class="pl-k">+</span> line);
  }
  <span class="pl-k">return</span> result;
};

<span class="pl-c"><span class="pl-c">//</span> DRAWING A TABLE with RIGHT-Alignment for Numbers</span>
<span class="pl-k">function</span> <span class="pl-en">dataTable</span>(<span class="pl-smi">data</span>) {
  <span class="pl-k">var</span> keys <span class="pl-k">=</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(data[<span class="pl-c1">0</span>]);
  <span class="pl-k">var</span> headers <span class="pl-k">=</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">UnderlinedCell</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(name));
  });
  <span class="pl-k">var</span> body <span class="pl-k">=</span> <span class="pl-smi">data</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">row</span>) {
    <span class="pl-k">return</span> <span class="pl-smi">keys</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
      <span class="pl-k">var</span> value <span class="pl-k">=</span> row[name];
      <span class="pl-c"><span class="pl-c">//</span> This was changed:</span>
      <span class="pl-k">if</span> (<span class="pl-k">typeof</span> value <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>number<span class="pl-pds">"</span></span>)
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">RTextCell</span>(<span class="pl-c1">String</span>(value));
      <span class="pl-k">else</span>
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-c1">String</span>(value));
    });
  });
  <span class="pl-k">return</span> [headers].<span class="pl-c1">concat</span>(body);
}

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">drawTable</span>(<span class="pl-en">dataTable</span>(<span class="pl-c1">MOUNTAINS</span>)));
<span class="pl-c"><span class="pl-c">//</span> → … beautifully aligned table</span></pre></div>
<h3 id="4122-a-vector-type">4.12.2. A Vector Type</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">Vector</span>(<span class="pl-smi">x</span>, <span class="pl-smi">y</span>) {
  <span class="pl-c1">this</span>.<span class="pl-c1">x</span> <span class="pl-k">=</span> x;
  <span class="pl-c1">this</span>.<span class="pl-c1">y</span> <span class="pl-k">=</span> y;
}

<span class="pl-smi">Vector</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">plus</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">other</span>) {
  <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">this</span>.<span class="pl-c1">x</span> <span class="pl-k">+</span> <span class="pl-smi">other</span>.<span class="pl-c1">x</span>, <span class="pl-c1">this</span>.<span class="pl-c1">y</span> <span class="pl-k">+</span> <span class="pl-smi">other</span>.<span class="pl-c1">y</span>);
};

<span class="pl-smi">Vector</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minus</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">other</span>) {
  <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">this</span>.<span class="pl-c1">x</span> <span class="pl-k">-</span> <span class="pl-smi">other</span>.<span class="pl-c1">x</span>, <span class="pl-c1">this</span>.<span class="pl-c1">y</span> <span class="pl-k">-</span> <span class="pl-smi">other</span>.<span class="pl-c1">y</span>);
};

<span class="pl-c1">Object</span>.<span class="pl-en">defineProperty</span>(<span class="pl-smi">Vector</span>.<span class="pl-c1">prototype</span>, <span class="pl-s"><span class="pl-pds">"</span>length<span class="pl-pds">"</span></span>, {
  <span class="pl-en">get</span><span class="pl-k">:</span> <span class="pl-k">function</span>() {
    <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">sqrt</span>(<span class="pl-c1">this</span>.<span class="pl-c1">x</span> <span class="pl-k">*</span> <span class="pl-c1">this</span>.<span class="pl-c1">x</span> <span class="pl-k">+</span> <span class="pl-c1">this</span>.<span class="pl-c1">y</span> <span class="pl-k">*</span> <span class="pl-c1">this</span>.<span class="pl-c1">y</span>);
  }
});

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>).<span class="pl-en">plus</span>(<span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>)));
<span class="pl-c"><span class="pl-c">//</span> → Vector{x: 3, y: 5}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>).<span class="pl-en">minus</span>(<span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>)));
<span class="pl-c"><span class="pl-c">//</span> → Vector{x: -1, y: -1}</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-k">new</span> <span class="pl-en">Vector</span>(<span class="pl-c1">3</span>, <span class="pl-c1">4</span>).<span class="pl-c1">length</span>);
<span class="pl-c"><span class="pl-c">//</span> → 5</span></pre></div>
<h3 id="4123-another-cell">4.12.3. Another cell</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">StretchCell</span>(<span class="pl-smi">inner</span>, <span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">inner</span> <span class="pl-k">=</span> inner;
  <span class="pl-c1">this</span>.<span class="pl-c1">width</span> <span class="pl-k">=</span> width;
  <span class="pl-c1">this</span>.<span class="pl-c1">height</span> <span class="pl-k">=</span> height;
}

<span class="pl-smi">StretchCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minWidth</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(<span class="pl-c1">this</span>.<span class="pl-c1">width</span>, <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">minWidth</span>());
};
<span class="pl-smi">StretchCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">minHeight</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(<span class="pl-c1">this</span>.<span class="pl-c1">height</span>, <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">minHeight</span>());
};
<span class="pl-smi">StretchCell</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">draw</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">width</span>, <span class="pl-smi">height</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">inner</span>.<span class="pl-en">draw</span>(width, height);
};

<span class="pl-k">var</span> sc <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">StretchCell</span>(<span class="pl-k">new</span> <span class="pl-en">TextCell</span>(<span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>), <span class="pl-c1">1</span>, <span class="pl-c1">2</span>);
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">sc</span>.<span class="pl-en">minWidth</span>());
<span class="pl-c"><span class="pl-c">//</span> → 3</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">sc</span>.<span class="pl-en">minHeight</span>());
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">sc</span>.<span class="pl-en">draw</span>(<span class="pl-c1">3</span>, <span class="pl-c1">2</span>));
<span class="pl-c"><span class="pl-c">//</span> → ["abc", "   "]</span></pre></div>
<h3 id="4124-sequence-interface">4.12.4. Sequence interface</h3>
<div class="highlight highlight-source-js"><pre><span class="pl-c"><span class="pl-c">//</span> I am going to use a system where a sequence object has two methods:</span>
<span class="pl-c"><span class="pl-c">//</span></span>
<span class="pl-c"><span class="pl-c">//</span> * next(), which returns a boolean indicating whether there are more</span>
<span class="pl-c"><span class="pl-c">//</span>   elements in the sequence, and moves it forward to the next</span>
<span class="pl-c"><span class="pl-c">//</span>   element when there are.</span>
<span class="pl-c"><span class="pl-c">//</span></span>
<span class="pl-c"><span class="pl-c">//</span> * current(), which returns the current element, and should only be</span>
<span class="pl-c"><span class="pl-c">//</span>   called after next() has returned true at least once.</span>

<span class="pl-k">function</span> <span class="pl-en">logFive</span>(<span class="pl-smi">sequence</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">5</span>; i<span class="pl-k">++</span>) {
    <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">sequence</span>.<span class="pl-c1">next</span>())
      <span class="pl-k">break</span>;
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">sequence</span>.<span class="pl-c1">current</span>());
  }
}

<span class="pl-k">function</span> <span class="pl-en">ArraySeq</span>(<span class="pl-smi">array</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">pos</span> <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>;
  <span class="pl-c1">this</span>.<span class="pl-smi">array</span> <span class="pl-k">=</span> array;
}
<span class="pl-smi">ArraySeq</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">next</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">pos</span> <span class="pl-k">&gt;=</span> <span class="pl-c1">this</span>.<span class="pl-smi">array</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>)
    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  <span class="pl-c1">this</span>.<span class="pl-smi">pos</span><span class="pl-k">++</span>;
  <span class="pl-k">return</span> <span class="pl-c1">true</span>;
};
<span class="pl-smi">ArraySeq</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">current</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">array</span>[<span class="pl-c1">this</span>.<span class="pl-smi">pos</span>];
};

<span class="pl-k">function</span> <span class="pl-en">RangeSeq</span>(<span class="pl-smi">from</span>, <span class="pl-smi">to</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">pos</span> <span class="pl-k">=</span> from <span class="pl-k">-</span> <span class="pl-c1">1</span>;
  <span class="pl-c1">this</span>.<span class="pl-smi">to</span> <span class="pl-k">=</span> to;
}
<span class="pl-smi">RangeSeq</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">next</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">pos</span> <span class="pl-k">&gt;=</span> <span class="pl-c1">this</span>.<span class="pl-smi">to</span>)
    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
  <span class="pl-c1">this</span>.<span class="pl-smi">pos</span><span class="pl-k">++</span>;
  <span class="pl-k">return</span> <span class="pl-c1">true</span>;
};
<span class="pl-smi">RangeSeq</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">current</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">pos</span>;
};

<span class="pl-en">logFive</span>(<span class="pl-k">new</span> <span class="pl-en">ArraySeq</span>([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]));
<span class="pl-c"><span class="pl-c">//</span> → 1</span>
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-en">logFive</span>(<span class="pl-k">new</span> <span class="pl-en">RangeSeq</span>(<span class="pl-c1">100</span>, <span class="pl-c1">1000</span>));
<span class="pl-c"><span class="pl-c">//</span> → 100</span>
<span class="pl-c"><span class="pl-c">//</span> → 101</span>
<span class="pl-c"><span class="pl-c">//</span> → 102</span>
<span class="pl-c"><span class="pl-c">//</span> → 103</span>
<span class="pl-c"><span class="pl-c">//</span> → 104</span>

<span class="pl-c"><span class="pl-c">//</span> This alternative approach represents the empty sequence as null,</span>
<span class="pl-c"><span class="pl-c">//</span> and gives non-empty sequences two methods:</span>
<span class="pl-c"><span class="pl-c">//</span></span>
<span class="pl-c"><span class="pl-c">//</span> * head() returns the element at the start of the sequence.</span>
<span class="pl-c"><span class="pl-c">//</span> </span>
<span class="pl-c"><span class="pl-c">//</span> * rest() returns the rest of the sequence, or null if there are no</span>
<span class="pl-c"><span class="pl-c">//</span>   elemements left.</span>
<span class="pl-c"><span class="pl-c">//</span></span>
<span class="pl-c"><span class="pl-c">//</span> Because a JavaScript constructor can not return null, we add a make</span>
<span class="pl-c"><span class="pl-c">//</span> function to constructors of this type of sequence, which constructs</span>
<span class="pl-c"><span class="pl-c">//</span> a sequence, or returns null if the resulting sequence would be</span>
<span class="pl-c"><span class="pl-c">//</span> empty.</span>

<span class="pl-k">function</span> <span class="pl-en">logFive2</span>(<span class="pl-smi">sequence</span>) {
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-c1">5</span> <span class="pl-k">&amp;&amp;</span> sequence <span class="pl-k">!=</span> <span class="pl-c1">null</span>; i<span class="pl-k">++</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">sequence</span>.<span class="pl-en">head</span>());
    sequence <span class="pl-k">=</span> <span class="pl-smi">sequence</span>.<span class="pl-en">rest</span>();
  }
}

<span class="pl-k">function</span> <span class="pl-en">ArraySeq2</span>(<span class="pl-smi">array</span>, <span class="pl-smi">offset</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">array</span> <span class="pl-k">=</span> array;
  <span class="pl-c1">this</span>.<span class="pl-smi">offset</span> <span class="pl-k">=</span> offset;
}
<span class="pl-smi">ArraySeq2</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">rest</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-smi">ArraySeq2</span>.<span class="pl-en">make</span>(<span class="pl-c1">this</span>.<span class="pl-smi">array</span>, <span class="pl-c1">this</span>.<span class="pl-smi">offset</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>);
};
<span class="pl-smi">ArraySeq2</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">head</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">array</span>[<span class="pl-c1">this</span>.<span class="pl-smi">offset</span>];
};
<span class="pl-smi">ArraySeq2</span>.<span class="pl-en">make</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">array</span>, <span class="pl-smi">offset</span>) {
  <span class="pl-k">if</span> (offset <span class="pl-k">==</span> <span class="pl-c1">null</span>) offset <span class="pl-k">=</span> <span class="pl-c1">0</span>;
  <span class="pl-k">if</span> (offset <span class="pl-k">&gt;=</span> <span class="pl-smi">array</span>.<span class="pl-c1">length</span>)
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">ArraySeq2</span>(array, offset);
};

<span class="pl-k">function</span> <span class="pl-en">RangeSeq2</span>(<span class="pl-smi">from</span>, <span class="pl-smi">to</span>) {
  <span class="pl-c1">this</span>.<span class="pl-smi">from</span> <span class="pl-k">=</span> from;
  <span class="pl-c1">this</span>.<span class="pl-smi">to</span> <span class="pl-k">=</span> to;
}
<span class="pl-smi">RangeSeq2</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">rest</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-smi">RangeSeq2</span>.<span class="pl-en">make</span>(<span class="pl-c1">this</span>.<span class="pl-smi">from</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>, <span class="pl-c1">this</span>.<span class="pl-smi">to</span>);
};
<span class="pl-smi">RangeSeq2</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">head</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">from</span>;
};
<span class="pl-smi">RangeSeq2</span>.<span class="pl-en">make</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">from</span>, <span class="pl-smi">to</span>) {
  <span class="pl-k">if</span> (from <span class="pl-k">&gt;</span> to)
    <span class="pl-k">return</span> <span class="pl-c1">null</span>;
  <span class="pl-k">else</span>
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">RangeSeq2</span>(from, to);
};

<span class="pl-en">logFive2</span>(<span class="pl-smi">ArraySeq2</span>.<span class="pl-en">make</span>([<span class="pl-c1">1</span>, <span class="pl-c1">2</span>]));
<span class="pl-c"><span class="pl-c">//</span> → 1</span>
<span class="pl-c"><span class="pl-c">//</span> → 2</span>
<span class="pl-en">logFive2</span>(<span class="pl-smi">RangeSeq2</span>.<span class="pl-en">make</span>(<span class="pl-c1">100</span>, <span class="pl-c1">1000</span>));
<span class="pl-c"><span class="pl-c">//</span> → 100</span>
<span class="pl-c"><span class="pl-c">//</span> → 101</span>
<span class="pl-c"><span class="pl-c">//</span> → 102</span>
<span class="pl-c"><span class="pl-c">//</span> → 103</span>
<span class="pl-c"><span class="pl-c">//</span> → 104</span></pre></div></article></body></html><script async>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>